(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"0MiI":function(e,t,n){"use strict";(function(e){var r=n("e+GP"),a=n.n(r);function i(t,n,r,a,i){return e("div",[t+(n?"[":"{"),e("button",{onclick:function(){return a[r]=!1}},"+"),n?"] ["+i+"]":"}"])}function o(t,n,r,a,i,o,c,u){var l=[];for(var d in l.push(t+(a?"[":"{")),l.push(e("button",{onclick:function(){return o[i]=!0}},"-")),n){var h=n[d],p=r.slice();p.push(d),l.push(s(d,h,p,o,c,u+1))}return l.push(a?"]":"}"),e("div",l)}function s(t,n,r,s,c,u){var l,d,h=null===t?"":t+" : ",p=JSON.stringify(r),f=void 0!==s[p]?s[p]:r.length>c.collapseAfter;return null!==n&&n instanceof Array?(l=n.length,f?i(h,!0,p,s,l):o(h,n,r,!0,p,s,c,u)):null!==n&&"object"===a()(n)?f?i(h,!1,p,s,u):o(h,n,r,!1,p,s,c,u):(d="function"==typeof n?"function":void 0===n?"undefined":JSON.stringify(n).replace(/"/g,"'"),h=t+" :"+Array(Math.max(1,12-(t||"").length)).fill("&nbsp;").join(""),u<3?e("div.fiob",e.trust(h),e("div.dib.fior.ma0",d)):e("div",e.trust(h+d)))}t.a=function(){var e={};return{view:function(t){var n=t.attrs,r=n.tree,a=n.options;return s(null,r,[],e,a,0)}}}}).call(this,n("mjLj"))},"0YGP":function(e,t,n){},"0iYD":function(e,t,n){"use strict";var r=n("Jnlq"),a=n("hpu3"),i=[],o={onresize:function(){i.forEach((function(e){"function"==typeof e.onresize&&e.onresize(innerWidth,innerHeight)})),a.c.redraw()},create:function(e,t){var n,a=!1;"function"==typeof t.onregister&&t.onregister((n=e,{send:function(e,t){i.forEach((function(r){r[e]&&"function"==typeof r[e]&&n!==r.name&&r[e]({source:n,msg:t})}))}})),"function"==typeof t.onresize&&t.onresize(innerWidth,innerHeight);var o=r.b.deepFreezeCreate({name:e,oncreate:function(){},onupdate:function(){},onbeforeupdate:function(){return!a},get preventUpdates(){return a},set preventUpdates(e){a=e}},t);return i.push(o),o}};t.a=o},"11NM":function(e,t,n){"use strict";(function(e){var r,a,i,o,s=n("wOn7"),c=n("Jnlq"),u=n("0iYD"),l=n("Wwkf"),d=n("MqTa"),h=u.a.create("ChessBoard",{onresize:d.a.Board.resize,oncreate:function(e){i=e.attrs.game,a=e.attrs.board,o=e.attrs.controller,Object(c.a)("div.chessboard").addEventListener("click",o.onfield.bind(o)),(r=new s.b(Object(c.a)("div.chessboard"),l.a.board.config)).initialization.then((function(){r.disableContextInput(),d.a.Board.resize(innerWidth,innerHeight),r.view.handleResize()}))},onbeforeremove:function(){return Object(c.a)("div.chessboard").removeEventListener("mousedown",o.onfield),Object(c.a)("div.chessboard").removeEventListener("touchdown",o.onfield),r.destroy().then((function(){r=void 0}))},view:function(){return e("div.chessboard")},onupdate:function(e){if(r){i=e.attrs.game,a=e.attrs.board,o=e.attrs.controller,r.disableMoveInput();try{r.view.handleResize()}catch(e){}r.getOrientation()!==a.orientation&&r.setOrientation(a.orientation)}else;},onafterupdates:function(){r&&i&&a&&r.setPosition(a.fen,!0).then((function(){o.update(r)}))}});t.a=h}).call(this,n("mjLj"))},"2vvF":function(e,t,n){"use strict";(function(e){var r=n("e+GP"),a=n.n(r),i={lineResult:function(e){var t="";return e.header.Result&&(t+=e.header.Result+" "),e.header.Termination&&(t+=e.header.Termination+" "),"object"===a()(e.timecontrol)&&(t+=e.timecontrol.caption+" "),"string"==typeof e.header.TimeControl&&(t+=e.header.TimeControl+" "),t},titlePlayers:function(t){return e.trust(t.header.White+" -<br>"+t.header.Black)}};t.a=i}).call(this,n("mjLj"))},"3EY0":function(e,t,n){e.exports=function(){return new Worker(n.p+"3e3d539777499a554072.worker.js")}},"4Glx":function(e,t,n){"use strict";(function(e){var r=n("hpu3"),a=n("QH1x"),i=n("0iYD"),o=n("Dpii"),s=n("MqTa"),c=n("Wwkf"),u=n("Jnlq"),l=i.a.create("GamesList",{view:function(t){return e(o.b,{class:"games-list"},t.attrs.games.map((function(t){return e(d,{game:t,onclick:function(e){a.a.Games.exists(t.uuid)||(t=u.b.clone(c.a.templates.game,t),s.a.Games.updateMoves(t),a.a.Games.create(t,!0),a.a.Games.update(t.uuid,{turn:t.moves.length-1},!0),a.a.Boards.create(u.b.clone(c.a.templates.board,{uuid:t.uuid}))),e.redraw=!1,r.c.route("/game/:turn/:uuid/",{uuid:t.uuid,turn:t.moves.length-1})}})})))}}),d=i.a.create("GameEntry",{view:function(t){var n=t.attrs,r=n.game,a=n.onclick,i="".concat(r.header.White," - ").concat(r.header.Black),o="".concat(r.date," ").concat(r.header.Site," ").concat(r.header.Event),s="";return r.header.Result&&(s+="<b>".concat(r.header.Result,"</b>")+" "),r.header.Termination&&(s+=r.header.Termination+" "),r.header.TimeControl&&(s+=r.header.TimeControl+" "),r.timestamp&&(s+=u.b.date2isoUtc(new Date(r.timestamp))+" "),r.plycount&&(s+=r.plycount+" plies "),s.length<18&&(o=s+" "+o,s=""),e("div.game-entry",{onclick:a},[e("div.game-line1.f4",i),e("div.game-line2.f5.ellipsis",e.trust(o)),s?e("div.game-line3.f5.ellipsis",e.trust(s)):""])}});t.a=l}).call(this,n("mjLj"))},"4VUy":function(e,t,n){"use strict";(function(e){var r=n("vVKl"),a="";t.a={view:function(){return e("div.w-100",[e("div.w-100.bg-eee",[e("input[type=text].w-100",{style:"background-color: #fff",oninput:function(e){return a=e.target.value+""},value:a,placeholder:"type to filter"})]),e("pre.w-100.bg-eee.pl3.viewport-xy.f7",[e.trust(r.a.search(a).slice(0,1e3).join("<br/>"))])])}}}).call(this,n("mjLj"))},"5SGU":function(e,t,n){"use strict";var r=n("Jnlq"),a=n("MqTa"),i=n("Wwkf"),o=n("Mebt");t.a=function(e){return[{group:"uuid",sort:0,title:"",active:!1,controls:[]},{group:"play-s-s",sort:20,title:"Stockfish - Stockfish",active:!0,controls:[{caption:"Depth",sort:10,type:"range",active:!0,value:function(){return e.depth},datalist:r.b.range(1,31).map((function(e){return e%5?{value:e}:{value:e,label:e}})),attributes:{oninput:function(t){var n=~~t.target.value;e.depth=n,e.autosubmit&&e.submit()},min:1,max:30,step:1,list:"dl-stockfish-depth"}},{caption:"Difficulty",sort:20,type:"passive",active:!0,value:function(){return a.a.resolveDifficulty(e.depth)+" ("+e.depth+")"}},{caption:"Timecontrol",sort:30,type:"selectindexed-split",active:!0,options:i.a.timecontrols,value:function(){return e.timecontrol},attributes:{onchange:function(t){e.timecontrol=i.a.timecontrols.find((function(e){return e.idx===~~t.target.value})),e.autosubmit&&e.submit()}}},{caption:"Openings",sort:40,type:"selectindexed-split",active:!0,options:i.a.openings,value:function(){return e.opening},attributes:{onchange:function(t){e.opening=i.a.openings.find((function(e){return e.idx===~~t.target.value})),e.autosubmit&&e.submit()}}},{caption:"Timestamp",sort:50,type:"timestamp",active:!e.autosubmit,value:function(){return e.timestamp},ontick:function(){return e.timestamp=new Date}},{caption:"Play",sort:90,type:"button",active:!e.autosubmit,attributes:{onclick:function(){e.submit(e)}}}]},{group:"play-h-s",sort:30,title:"Human - Stockfish",active:!0,controls:[{caption:"Depth",sort:10,type:"range",active:!0,value:function(){return e.depth},datalist:r.b.range(1,31).map((function(e){return e%5?{value:e}:{value:e,label:e}})),attributes:{oninput:function(t){var n=~~t.target.value;e.depth=n,e.difficulty=a.a.resolveDifficulty(n),e.autosubmit&&e.submit()},min:1,max:30,step:1,list:"dl-stockfish-depth"}},{caption:"Difficulty",sort:20,type:"passive",active:!0,value:function(){return a.a.resolveDifficulty(e.depth)+" ("+e.depth+")"}},{caption:"Timecontrol",sort:30,type:"selectindexed-split",active:!0,options:i.a.timecontrols,value:function(){return e.timecontrol},attributes:{onchange:function(t){e.timecontrol=i.a.timecontrols.find((function(e){return e.idx===~~t.target.value})),e.autosubmit&&e.submit()}}},{caption:"Timestamp",sort:80,type:"timestamp",active:!e.autosubmit,value:function(){return e.timestamp},ontick:function(){return e.timestamp=new Date}},{caption:"Play",sort:90,type:"button",active:!e.autosubmit,attributes:{onclick:function(){e.submit(e)}}}]},{group:"user-data",sort:10,title:"User",active:!0,controls:[{caption:"Name",sort:10,type:"text-split",active:!0,value:function(){return e.name},attributes:{placeholder:"your name",onchange:function(t){e.name=t.target.value,e.autosubmit&&e.submit()}}}]},{group:"board-illustrations",sort:40,title:"Illustrations",active:!0,controls:[{caption:"Best move",sort:10,type:"checkbox",active:!0,value:function(){return e.bestmove},attributes:{type:"checkbox",onchange:function(t){e.bestmove=!!t.target.checked,e.autosubmit&&e.submit()}}},{caption:"Last Move",sort:20,type:"checkbox",active:!0,value:function(){return e.lastmove},attributes:{type:"checkbox",onchange:function(t){e.lastmove=!!t.target.checked,e.autosubmit&&e.submit()}}}]},{group:"game-evaluator",sort:50,title:"Evaluator",active:!0,controls:[{caption:"Max Threads",sort:10,type:"range",active:!0,value:function(){return e.maxthreads},datalist:r.b.range(1,o.a.threads).map((function(e){return{value:e}})),attributes:{oninput:function(t){e.maxthreads=~~t.target.value,e.autosubmit&&e.submit()},min:1,max:o.a.threads-1,step:1,list:"dl-evaluator-threads"}},{caption:"Max Depth",sort:20,type:"number",active:!0,value:function(){return e.maxdepth},dimension:"deep",attributes:{min:1,max:50,step:1,onchange:function(t){e.maxdepth=~~t.target.value,e.autosubmit&&e.submit()}}},{caption:"Max Wait",sort:30,type:"number",active:!0,value:function(){return e.maxsecs},dimension:"secs",attributes:{min:"0.1",max:"5.0",step:"0.1",onchange:function(t){e.maxsecs=parseFloat(t.target.value),e.autosubmit&&e.submit()}}}]},{group:"sources-pgn",sort:60,title:"API Enpoints",active:!0,controls:[{caption:"Endpoint",sort:2,type:"selectindexed",active:!0,options:i.a.apis,value:function(){return e.api},attributes:{onchange:function(t){e.api=i.a.apis.find((function(e){return e.idx===~~t.target.value})),e.autosubmit&&e.submit()}}}]},{group:"ui",sort:70,title:"Other",active:!0,controls:[{caption:"Loader",sort:10,type:"checkbox",active:!0,value:function(){return e.waitscreen},attributes:{type:"checkbox",onchange:function(t){e.waitscreen=!!t.target.checked,e.autosubmit&&e.submit()}}}]}]}},"8B4M":function(e,t,n){},"97EL":function(e,t,n){"use strict";(function(e){var r=n("5WRv"),a=n.n(r),i=n("OvAC"),o=n.n(i),s=n("5SGU"),c=n("Jnlq"),u=n("0iYD");function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=c.b.interprete,p=function(){var t,n;return{name:"TimeStamp",oncreate:function(r){var a=r.dom,i=r.attrs;t=a,n=setInterval((function(){e.render(t,c.b.date2isoLocal(new Date)),i.control.ontick()}),1e3)},onremove:function(){clearInterval(n)},view:function(t){return e("div",t.attrs,c.b.date2isoLocal(new Date))}}};function f(t,n){return e("[",[!t&&e("div.group.title.sair",n.title)].concat(a()(n.controls.sort((function(e,t){return e.sort-t.sort})).filter((function(e){return e.active})).map((function(t){return e("div.control",function(t){if("button"===t.type)return t.title?[e("div.control-label-40",t.title),e("div.control-60",e("button.w-100",t.attributes,h(t.caption)))]:[e("div.control-100",e("button.tc.w-100.pv1.ph2",t.attributes,h(t.caption)))];if("passive"===t.type)return[e("div.control-label-40",h(t.caption)),e("div.control-60",h(t.value))];if("timestamp"===t.type)return[e("div.control-label-40",h(t.caption)),e(p,{class:"control-60",control:t})];if("checkbox"===t.type)return t.attributes.checked=h(t.value),[e("div.control-label-40",h(t.caption)),e("div.control-60",e('input[type="checkbox"]',t.attributes))];if("text"===t.type)return t.attributes.value=h(t.value),[e("div.control-label-100",h(t.caption)),e("div.control-100",e('input[type="text"].w-100',t.attributes))];if("text-split"===t.type)return t.attributes.value=h(t.value),[e("div.control-label-40",h(t.caption)),e("div.control-60",e('input[type="text"].w-100',t.attributes))];if("url"===t.type)return t.attributes.value=h(t.value),[e("div.control-label-100",h(t.caption)),e("div.control-60",e('input[type="url"].w-100',t.attributes))];if("colorbox"===t.type)return t.attributes.value=h(t.value),e('input[type="color"]',t.attributes);if("range"===t.type)return t.attributes.value=h(t.value),[e("div.control-label-40",h(t.caption)),e("div.control-60",e('input[type="range"]',t.attributes)),t.attributes.list?e("datalist",{id:t.attributes.list},Array.from(t.datalist).map((function(t){return e("option",t)}))):e("span")];if("number"===t.type)return t.attributes.value=h(t.value),t.dimension?[e("div.control-label-40",h(t.caption)),e('input[type="number"].w-30',t.attributes),e("div.dimension.w-30",t.dimension)]:[e("div.control-label-40",h(t.caption)),e("div.control-60",e('input[type="number"].w-100',t.attributes))];if("select"===t.type)return[e("div.control-label-100",h(t.caption)),e("div.control-100",e("select.mh3",t.attributes,Array.from(t.options).map((function(t){return e("option",t)}))))];if("selectindexed"===t.type){var n=h(t.value).idx;return[e("div.control-label-100",h(t.caption)),e("div.tl.f5.pl3.pv2.w-100",e("select.ph2.w-100",{style:"padding-top: 2px; padding-bottom: 2px;"},t.attributes,Array.from(t.options).map((function(t){return e("option",{value:t.idx,selected:t.idx===n},t.caption)}))))]}if("selectindexed-split"===t.type){var r=h(t.value).idx;return[e("div.control-label-40",h(t.caption)),e("div.control-60",e("select.ph2.w-100",d({style:"padding-top: 2px; padding-bottom: 2px;"},t.attributes),Array.from(t.options).map((function(t){return e("option",{value:t.idx,selected:t.idx===r},t.caption)}))))]}return t.type+" unknown"}(t))})))))}var m=u.a.create("Forms",{view:function(t){var n=t.attrs,r=n.formdata,a=n.noheader,i=n.className,o=n.style;return e("div.forms",{className:i,style:o},Object(s.a)(r).filter((function(e){return e.group===r.group})).sort((function(e,t){return e.sort-t.sort})).map(f.bind(null,!!a)))}});t.a=m}).call(this,n("mjLj"))},"9ubP":function(e,t,n){"use strict";(function(e){n("j26v");var r=n("MqTa"),a=n("QH1x"),i=n("0iYD"),o=n("e3Qi"),s=n("lJ9B"),c=n("Qie3"),u=n("Dpii"),l=i.a.create("Game",{view:function(t){var n=t.attrs,i=n.params,l=i.uuid,d=void 0===l?"default":l,h=i.turn,p=void 0===h?-1:h,f=n.className,m=n.style,v=a.a.Games.find(d),g=a.a.Boards.find(d),b=r.a.Format.titlePlayers(v),w=r.a.Format.lineResult(v);return r.a.Games.scrollTurnIntoView(~~p),innerWidth>=720?e("div.page.game",{className:f,style:m},[e(u.j,{className:"gm-players tc"},b),e(o.a,{board:g}),e(c.a,{game:v}),e(u.k),e(u.l,{class:"gm-result",title:"result termination timecontrol"},w),e(u.f)]):e("div.page.game",{className:f,style:m},[e(u.j,{className:"gm-players tc"},b),e(s.a,{params:{uuid:d,turn:~~p}}),e(c.a,{game:v}),e(u.k),e(u.l,{class:"gm-result",title:"result termination timecontrol"},w),e(u.f)])}});t.a=l}).call(this,n("mjLj"))},B1qE:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var r=n("Wwkf"),a=n("Jnlq"),i=n("QH1x"),o=n("hpu3"),s=function(e,t){return a.b.scale(a.b.clamp(Math.abs(t),.001,e.score.maxcp),0,e.score.maxcp,1,20)},c={name:"PlyTD",view:function(t){var n=t.attrs,a=n.game,c=n.player,u=n.move,l=n.back,d=function(e,t){return t.cp&&((t.turn%2==0&&t.cp)>0||(t.turn%2==1&&t.cp)>0)?~~s(e,t.cp):0}(a,u),h=r.a.pieces.font[u.piece],p=function(e){e.redraw=!1,i.a.Games.update(a.uuid,{turn:u.turn}),o.c.route("/game/:turn/:uuid/",{turn:u.turn,uuid:a.uuid},{replace:!0})},f=u.mate?"# in "+Math.abs(u.mate):"",m=r.a.flagTitles[u.flags],v=u.pv?u.pv.split(" ").slice(0,3).join(" "):"",g=u.pv?u.cp||":"+v:"",b=u.mate&&u.pv?v:"",w=f?b:g;return e("[",[e("td.gm-ply-pic-"+c+l,{onclick:p,title:m,"data-turn":u.turn},h),e("td.gm-ply-san-"+c+l,{onclick:p,title:m},u.san),e("td.gm-ply-val-"+c+l,{onclick:p,title:w},[f?e("div.gm-ply-mate-"+c,f):e("div.gm-ply-bar-"+c,{style:"width:"+d+"px"})])])}},u={name:"PlySP",view:function(t){var n=t.attrs,a=n.game,s=n.player,c=n.move,u=n.back,l=r.a.pieces.font[c.piece],d=r.a.flagTitles[c.flags],h=function(e){e.redraw=!1,i.a.Games.update(a.uuid,{turn:c.turn}),o.c.route("/game/:turn/:uuid/",{turn:c.turn,uuid:a.uuid},{replace:!0})};return e("[",[e("span.gm-ply-pic-"+s+u,{onclick:h,title:d,"data-turn":c.turn},l),e("span.gm-ply-san-"+s+u,{onclick:h,title:d},c.san)])}},l={name:"MoveRow",view:function(t){var n=t.attrs,r=n.game,a=n.num,i=n.white,o=n.black,s=i.move.turn!==r.turn?".bg-transparent":".bg-89b",u=o.move.turn!==r.turn?".bg-transparent":".bg-89b";return e("tr.gm-move.trhover",[e("td.gm-move-space"),e("td.gm-move-num",a),e(c,{game:r,back:s,move:i.move,player:"w"}),e(c,{game:r,back:u,move:o.move,player:"b"}),e("td.gm-move-space")])}},d={name:"MoveSpan",view:function(t){var n=t.attrs,r=n.game,a=n.num,i=n.white,o=n.black,s=i.move.turn!==r.turn?".bg-transparent":".bg-89b",c=o.move.turn!==r.turn?".bg-transparent":".bg-89b";return e("span.gm-move",{style:"padding-right: 8px"},[e("span.gm-move-num",{style:"font-weight: 800"},a),e(u,{game:r,back:s,move:i.move,player:"w"}),e(u,{game:r,back:c,move:o.move,player:"b"})])}}}).call(this,n("mjLj"))},CNX3:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r,a,i=n("Jnlq"),o=n("QH1x"),s=n("hpu3"),c=n("Mebt"),u=n("vdVe"),l=n("0iYD"),d=n("vVKl"),h=0,p={listen:function(){window.addEventListener("load",s.c.onload),window.addEventListener("beforeunload",p.onbeforeunload),window.addEventListener("online",p.ononline),window.addEventListener("offline",p.onoffline),window.addEventListener("resize",p.onresize),window.addEventListener("popstate",u.a.onpopstate),window.addEventListener("hashchange",u.a.onhashchange),window.addEventListener("deviceorientation",p.ondeviceorientation),document.addEventListener("beforeinstallprompt",p.onbeforeinstallprompt),document.addEventListener("selectionchange",p.onselectionchange),document.addEventListener("dblclick",i.b.eat)},onresize:function(){var e=innerWidth>innerHeight?"landscape":"portrait",t=h<=360&&innerWidth>360||h>360&&innerWidth<=360||h>720&&innerWidth<=720||h<=720&&innerWidth>720||a!==e;l.a.onresize(),t&&s.c.redraw(),h=innerWidth,a=e},onbeforeinstallprompt:function(e){d.a.log("events","onbeforeinstallprompt");var t=document.querySelector(".a2hs-button");e.preventDefault(),r=e,t.style.display="block",t.addEventListener("click",(function(){t.style.display="none",r.prompt(),r.userChoice.then((function(e){e.outcome,r=null}))}))},ononline:function(){c.a.online=!0},onoffline:function(){c.a.online=!1},onbeforeunload:function(){o.a.Usage.update("0",{lastend:Date.now()},!0),console.log("Bye...")},onselectionchange:function(){},onpopstate:function(){},hashchange:function(e){}}},Dpii:function(e,t,n){"use strict";(function(e){n.d(t,"i",(function(){return i})),n.d(t,"k",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"h",(function(){return c})),n.d(t,"j",(function(){return u})),n.d(t,"g",(function(){return l})),n.d(t,"l",(function(){return h})),n.d(t,"m",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return g}));n("UdF5");var r=n("Jnlq"),a=n("0iYD"),i=(a.a.create("Error",{view:function(t){var n=t.attrs,r=t.children;return e("div.error",{style:"padding: 1rem 2rem; color: darkred"},e("span.f4",n,r))}}),a.a.create("Nothing",{view:function(){return e("div.nothing.dn")}})),o=a.a.create("Spacer",{view:function(t){return e("div.spacer",t.attrs,e.trust("&nbsp;"))}}),s={view:function(t){var n=t.attrs;return e("div.spacer.flex-grow",n,e.trust("&nbsp;"))}},c={view:function(t){var n=t.attrs.oninput;return e("input[type=text].w-100.pv2.ph3.bg-ddd.f4",{style:"border: 0",oninput:n,placeholder:"type to filter"})}},u=a.a.create("PageTitle",{view:function(t){var n=t.attrs,r=t.children;return e("page-title",{className:n.className},e("span",{style:n.style},r))}}),l={view:function(t){return e("div.header-left.tl.saim.f3.white",e("span",t.attrs,t.children))}},d={view:function(t){return e("div.text-left.tl.fiom.f4.white",e("span",t.attrs,t.children))}},h={view:function(t){return e("div.text-center.tc.fiom.f4.white",e("span",t.attrs,t.children))}},p={view:function(t){return e("div.flexlist",t.attrs,t.children)}},f={view:function(t){return e("div.fixedlist.viewport-y.noselect",t.attrs,t.children)}},m={view:function(t){return e("div.flexlist.flex.flex-column.flex-shrink.viewport-y.noselect",t.attrs,t.children)}},v={view:function(t){var n=t.attrs,r=n.style,a=n.onclick;return e("div.flexlistentry",{style:r,onclick:a},t.children)}},g={view:function(t){var n=t.attrs,a=n.play,i=n.onclick;return e(v,{onclick:i},[e(".fiom.f4",a.white+" vs "+a.black),e(".fior.f5",r.b.date2isoLocal(new Date(a.timestamp))),e(".fior.f5","".concat(a.difficulty," (").concat(a.depth,") / ").concat(a.time," secs"))])}}}).call(this,n("mjLj"))},Ehzf:function(e,t,n){"use strict";(function(e){var r=n("0iYD"),a=n("Jnlq"),i=null,o=r.a.create("Backdrop",{show:function(e){Object(a.a)("back-drop").classList.add("visible"),i=e||null},hide:function(){Object(a.a)("back-drop").classList.remove("visible")},view:function(){return e("back-drop",{onclick:function(e){e.redraw=!1,o.hide(),i&&i()}})}});t.a=o}).call(this,n("mjLj"))},I75Z:function(e,t,n){"use strict";(function(e){var r,a=n("0iYD").a.create("GameProgressBar",{render:function(e){r&&(r.innerHTML='<div class="gm-progress" style="width:'.concat(e,'%">'))},oncreate:function(e){var t=e.dom;r=t},view:function(){return e("div.gm-bar-progress")}});t.a=a}).call(this,n("mjLj"))},JSL1:function(e,t,n){"use strict";(function(e){var r=n("NthX"),a=n.n(r),i=n("fFdx"),o=n.n(i),s=n("hpu3"),c=n("qxKj"),u=n("0iYD"),l=n("Dpii"),d=u.a.create("Sources",{view:function(t){var n=t.attrs,r=n.className,i=n.style;return e("div.page.sources",{className:r,style:i},[e(l.j,"Choose a Game Collection"),e(l.b,c.a.list().map((function(t){var n=function(){var e=o()(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.redraw=!1,t.games.length){e.next=7;break}return e.next=4,t.fetch();case 4:t.error||s.c.route("/games/:idx/",{idx:t.idx}),e.next=8;break;case 7:s.c.route("/games/:idx/",{idx:t.idx});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return e(l.c,{onclick:n,class:"sources"},[e("img.source-icon",{src:t.icon}),e("div.source-caption.f4",t.caption),e("div.source-subline.f5.ellipsis",t.subline),t.games.length?e("div.games-loaded",t.games.length+" games loaded"):"",t.error?e("div.source-error.f5",t.error):"",t.progress?e("div.source-progress-on",{style:"width: ".concat(t.progress,"%;")}):e("div.source-progress-off")])}))),e(l.g,"Or download Online Games"),e(l.f)])}});t.a=d}).call(this,n("mjLj"))},Jnlq:function(e,t,n){"use strict";n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return d}));var r=n("5WRv"),a=n.n(r),i=n("nxTg"),o=n.n(i),s=n("e+GP"),c=n.n(s);function u(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=document.querySelector.bind(document),h=(document.querySelectorAll.bind(document),{create:function(){var e=arguments.length?Object.assign.apply(null,arguments):{};return Object.setPrototypeOf(e,null),e},clone:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Object.assign.apply(null,[{}].concat(t)),a=h.deepcopy(r);return Object.setPrototypeOf(a,null),a},clear:function(e){return Object.keys(e).forEach((function(t){return delete e[t]})),e},createFreeze:function(e){return h.freeze(h.create(e))},deepFreezeCreate:function(){var e,t=arguments.length?Object.assign.apply(null,arguments):{},n=Object.getOwnPropertyNames(t),r=u(n);try{for(r.s();!(e=r.n()).done;){var a=e.value,i=t[a];i&&"object"===c()(i)&&(Object.setPrototypeOf(i,null),Object.freeze(i))}}catch(e){r.e(e)}finally{r.f()}return Object.setPrototypeOf(t,null),Object.freeze(t),t},freeze:function(e){return Object.freeze(e)},deepFreeze:function(e){var t,n=u(Object.getOwnPropertyNames(e));try{for(n.s();!(t=n.n()).done;){var r=e[t.value];r&&"object"===c()(r)&&h.deepFreeze(r)}}catch(e){n.e(e)}finally{n.f()}return Object.freeze(e)},each:function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])},strip:function(e){var t=h.create(e);return Object.entries(t).forEach((function(e){var n=o()(e,1)[0];void 0===t[n]&&delete t[n]})),t},shrink:function(e){return JSON.stringify(h.strip(e)).replace(/"/g,"").slice(0,140)},deepcopy:function(e){return JSON.parse(JSON.stringify(e))},deepassign:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,s=n;i<s.length;i++)for(var c=s[i],u=0,l=Object.entries(c);u<l.length;u++){var d=o()(l[u],2),p=d[0],f=d[1];Array.isArray(f)?e[p]=a()(f):f instanceof Object&&p in e&&(f=h.deepassign(e[p],f)),e[p]=f}return e},difference:function(e,t){return Object.entries(t).reduce((function(n,r){var a=o()(r,2),i=a[0],s=a[1];return e[i]&&s===e[i]||(n[i]=t[i]),n}),h.create())},map:function(e,t){var n=[];for(var r in e)n.push(t(r,e[r]));return n},transform:function(e,t){var n=h.create();return Object.keys(e).forEach((function(r){n[r]=t(r,e[r])})),n},range:function(e,t,n){var r,a=[],i=arguments.length;if(0===i)return a;for(1===i&&(t=e,e=0,n=1),2===i&&(n=1),r=e;r<t;r+=n)a.push(r);return a},partitions:function(e,t){var n=[];return h.range(t).forEach((function(){n.push([])})),e.forEach((function(e,r){n[r%t].push(e)})),n},scale:function(e,t,n,r,a){return(a-r)*(e-t)/(n-t)+r},clamp:function(e,t,n){return e<t?t:e>n?n:e},isVisibleInView:function(e,t){if(e&&t){var n=e.getBoundingClientRect(),r=n.top,a=n.bottom,i=n.height,o=t.getBoundingClientRect();return r<=o.top?o.top-r<=i:a-o.bottom<=i}return!0},format:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=0,i=e.split("%s");return i.map((function(e){return e+(n[a++]||"")})).join("")},padZero:function(e,t){return("000000"+e).slice(-(t||2))},hash:function(e){var t,n=0;if(0===e.length)throw"Can't do this";for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n.toString(36)},sleep:function(e){return new Promise((function(t){return setTimeout(t,e)}))},msec2HMSm:function(e){var t=new Date(e);return[h.padZero(t.getUTCHours()),h.padZero(t.getUTCMinutes()),h.padZero(t.getUTCSeconds())].join(":")+"."+Math.floor(t.getMilliseconds()/100)},msec2HMS:function(e){var t=new Date(e);return[h.padZero(t.getUTCHours()),h.padZero(t.getUTCMinutes()),h.padZero(t.getUTCSeconds())].join(":")},date2isoUtc:function(e){var t=e||new Date;return[t.getUTCFullYear(),h.padZero(t.getUTCMonth()+1),h.padZero(t.getUTCDate())].join("-")+" "+[h.padZero(t.getUTCHours()),h.padZero(t.getUTCMinutes()),h.padZero(t.getUTCSeconds())].join(":")},date2isoLocal:function(e){var t=e||new Date;return[t.getFullYear(),h.padZero(t.getMonth()+1),h.padZero(t.getDate())].join("-")+" "+[h.padZero(t.getHours()),h.padZero(t.getMinutes()),h.padZero(t.getSeconds())].join(":")},eat:function(e){return e.preventDefault(),e.stopPropagation(),!1},classes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";for(var r in e)e[r]&&(n+="".concat(n&&t)+r);return n},interprete:function(e){return"function"==typeof e?e():e},msecs2human:function(e){function t(e){return e>1?"s":""}var n=Math.floor(e/1e3),r=Math.floor(n/31536e3);if(r)return r+" year"+t(r);var a=Math.floor((n%=31536e3)/86400);if(a)return a+" day"+t(a);var i=Math.floor((n%=86400)/3600);if(i)return i+" hour"+t(i);var o=Math.floor((n%=3600)/60);if(o)return o+" minute"+t(o);var s=n%60;return s?s+" second"+t(s):"less than a second"}})},Mebt:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r,a=n("e+GP"),i=n.n(a),o={plattform:navigator.platform,userAgent:navigator.userAgent,threads:navigator.hardwareConcurrency,vendor:navigator.vendor,touch:"ontouchstart"in document.documentElement,fetch:!!window.fetch,online:!!Navigator.onLine,languages:navigator.languages.join("|"),vibration:!!window.navigator.vibrate,localStorage:!!window.localStorage,serviceWorker:!!navigator.serviceWorker,fullscreen:!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen),wasm:"object"===("undefined"==typeof WebAssembly?"undefined":i()(WebAssembly))&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0)),is64bit:function(){for(var e=0,t=["x86_64","x86-64","Win64","x64","amd64","AMD64"];e<t.length;e++){var n=t[e];if(navigator.userAgent.indexOf(n)>=0)return!0}return"Linux x86_64"===navigator.platform||"MacIntel"===navigator.platform||"Linux aarch64"===navigator.platform}(),BigInt:!!window.BigInt,screen:{width:screen.width,height:screen.height,aspect:screen.width/screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,get innerWidth(){return innerWidth},get innerHeight(){return innerHeight},colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,left:screen.left,top:screen.top,orientation:(screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation,devicePixelRatio:window.devicePixelRatio,"safe-area-inset-top":getComputedStyle(document.documentElement).getPropertyValue("--sat"),"safe-area-inset-right":getComputedStyle(document.documentElement).getPropertyValue("--sar"),"safe-area-inset-bottom":getComputedStyle(document.documentElement).getPropertyValue("--sab"),"safe-area-inset-left":getComputedStyle(document.documentElement).getPropertyValue("--sal")},Atomics:"object"===("undefined"==typeof Atomics?"undefined":i()(Atomics)),SharedArrayBuffer:"function"==typeof SharedArrayBuffer,OffscreenCanvas:"function"==typeof OffscreenCanvas,sharedMemory:function(){try{r=new WebAssembly.Memory({shared:!0,initial:8,maximum:16})}catch(e){return!1}return!0}(),cloning:function(){try{window.postMessage(r,"*")}catch(e){return!1}return!0}(),growable:function(){try{r.grow(8)}catch(e){return!1}return!0}(),SharedMemory:function(){try{return r.buffer instanceof SharedArrayBuffer}catch(e){return!1}}(),transitionEnd:function(){var e,t=document.createElement("div"),n={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e])return n[e]}(),log:function(){var e=o;console.log("Info   :",navigator.hardwareConcurrency+" Threads","LS"+(e.hasLocalStorage?"+":"-"),"FS"+(e.fullscreenEnabled?"+":"-"),"SM"+(e.sharedMemory?"+":"-"),"SAB"+(e.SharedArrayBuffer?"+":"-"),"wasm"+(e.wasmSupported?"+":"-"),"64bit"+(e.is64Bit?"+":"-"),"Atoms"+(e.Atomics?"+":"-"),"Clones"+(e.cloning?"+":"-"),"Growables"+(e.growable?"+":"-"),"OSCanvas"+(e.OffscreenCanvas?"+":"-"))}};o.log()},MqTa:function(e,t,n){"use strict";var r=n("OvAC"),a=n.n(r),i=n("uoUx"),o=n.n(i),s=n("Jnlq"),c={resize:function(e,t){if(e>=720){var n=e-360,r=t-210,a=Object(s.a)("div.chessboard"),i=Object(s.a)("section.content"),o=Math.min(n,r)+4;a&&(a.style.width=o+"px"),a&&(a.style.height=o+"px"),i&&(i.style.maxWidth=o+"px")}},isValid:function(e,t){var n=new o.a;return n.load(e.fen()),n.move(t)?n.fen():""},updateArrows:function(e,t,n){var r=e.history({verbose:!0}).slice(-2),a=n.illustrations.arrows;if(t.removeArrows(null),a.bestmoves){var i=n.bestmove.move,o=n.bestmove.ponder;i.from&&o.from&&(t.addArrow(o.from,o.to,{class:"arrow ponder"}),t.addArrow(i.from,i.to,{class:"arrow bestmove",onclick:function(){}}))}a.validmoves&&a.moveStart&&e.moves({verbose:!0}).filter((function(e){return e.from===a.moveStart})).forEach((function(e){t.addArrow(e.from,e.to,{class:"arrow validmove"})})),a.pinned&&t.addArrow("c1","c8",{class:"arrow pinned"}),a.last&&r.forEach((function(e){t.addArrow(e.from,e.to,{class:"w"===e.color?"arrow last-white":"arrow last-black"})})),a.test&&(t.addArrow("e2","e4",{class:"arrow test"}),t.addArrow("f2","h4",{class:"arrow test"}),t.addArrow("d2","c4",{class:"arrow test"}),t.addArrow("c2","a3",{class:"arrow test"}),t.addArrow("d7","d5",{class:"arrow test"}),t.addArrow("c7","c5",{class:"arrow test"}),t.addArrow("g7","g8",{class:"arrow test"}),t.addArrow("g7","h8",{class:"arrow test"}),t.addArrow("g7","h7",{class:"arrow test"}),t.addArrow("g7","h6",{class:"arrow test"}),t.addArrow("g7","g6",{class:"arrow test"}),t.addArrow("g7","f6",{class:"arrow test"}),t.addArrow("g7","f7",{class:"arrow test"}),t.addArrow("g7","f8",{class:"arrow test"}))},squareIndexToField:function(e){var t=Math.floor(e/8)+1,n=e%8;return String.fromCharCode(97+n)+t}},u=n("Wwkf"),l=n("QH1x"),d={interpolate:function(e,t){var n=e;return s.b.each(t,(function(e,t){n=n.replace(":"+e,t)})),n},resolveDifficulty:function(e){var t=u.a.plays.difficulties,n=t[0],r=n;return s.b.range(0,31).forEach((function(a){n=t[a]?t[a]:n,r=~~a<=e?n:r})),r}},h={hash:function(e){var t=JSON.stringify({1:e.header.White,2:e.header.Black,3:e.header.Event,4:e.header.Site,5:e.header.Date,6:e.header.Result,7:e.pgn.slice(0,20)});return s.b.hash(t)},fen:function(e){var t=~~e.turn;return-2===t?u.a.fens.empty:-1===t?u.a.fens.start:e.moves[t].fen},captured:function(e){var t=h.fen(e);if(t===u.a.fens.empty)return{black:"lwtnjo".split(""),white:"lwtnjo".split("")};if(t===u.a.fens.start)return{black:[],white:[]};var n=function(e,t){return u.a.pieces.fens.sorted.indexOf(e.toLowerCase())-u.a.pieces.fens.sorted.indexOf(t.toLowerCase())},r=u.a.pieces.fens.black,a=u.a.pieces.fens.white;return t.split(" ")[0].split("").forEach((function(e){r=r.replace(e,""),a=a.replace(e,"")})),r=r.split("").sort(n).map((function(e){return u.a.pieces.font[e]})),a=a.split("").sort(n).map((function(e){return u.a.pieces.font[e]})),{black:r,white:a}},scrollTurnIntoView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;setTimeout((function(){var t='td[data-turn="'+e+'"]',n=s.b.isVisibleInView(Object(s.a)(t),Object(s.a)("div.gm-moves"));t||console.warn("scrollIntoView",t,"div.gm-moves"),!n&&Object(s.a)(t)&&Object(s.a)(t).scrollIntoView(!0)}),t)},timeLine:function(e){var t="";return e.date?t+=e.date:e.timestamp&&(t+=s.b.date2isoUtc(new Date(e.timestamp))),t},resolvePlayers:function(e){var t=u.a.opponents,n=l.a.Options.first["user-data"].name,r=e.mode[0],a=e.mode[2];return{white:"Human"===t[r]?n:t[r],black:"Human"===t[a]?n:t[a]}},fromPlayForm:function(e,t){var n=h.resolvePlayers(e),r=n.white,a=n.black,i=s.b.clone(u.a.templates.game,e,t,{difficulty:d.resolveDifficulty(t.depth),timestamp:Date.now()});return i.turn=-1,i.uuid=s.b.hash(JSON.stringify(i)),i.header.White=r,i.header.Black=a,delete i.autosubmit,delete i.group,delete i.submit,console.log("games.fromPlayForm",i),i},updateMoves:function(e){if(""===e.pgn)return e.moves=[],void(e.plycount=0);var t=new o.a,n=new o.a;!t.load_pgn(e.pgn)&&console.warn("gametools.updateMoves.failed",e.pgn),t.history({verbose:!0}).map((function(t,r){n.move(t),t.fen=n.fen(),t.turn=r,e.moves.push(t)})),e.plycount=e.moves.length}},p=h,f=n("2vvF");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a=v({},d,{Board:v({},c),Games:v({},p),Format:v({},f.a)})},QH1x:function(e,t,n){"use strict";var r=n("OvAC"),a=n.n(r),i=n("tNDA"),o=n("hpu3"),s=n("Mebt"),c={uuid:"0","user-data":{name:"noiv"},"play-h-s":{depth:1,timecontrol:{idx:0,caption:"10 secs",value:"".concat(1e4,"|0")},opening:{idx:1,label:"OP01"}},"play-s-h":{depth:2,timecontrol:{idx:0,caption:"10 secs",value:"".concat(1e4,"|0")},opening:{idx:2,label:"OP02"}},"play-s-s":{depth:3,timecontrol:{idx:0,caption:"10 secs",value:"".concat(1e4,"|0")},opening:{idx:3,label:"OP03"}},"game-evaluator":{engine:"stockfish",maxthreads:2,maxdepth:5,maxsecs:1,divisor:2},"board-illustrations":{pinning:!0,bestmove:!0,lastmove:!0,availmoves:!0,attack:!0,valid:!0,test:!1},"board-decoration":{decoration:!1,"light-color":"#789","dark-color":"#987"},ui:{waitscreen:!0},other:{"ui-collapsed":{"section-left":!1}}},u=n("Wwkf"),l=n("Jnlq"),d=function(e){var t,n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=!0,c=i(e);function d(){r=setInterval((function(){s&&t.persist(!0)}),u.a.database.updateInterval||6e4)}return c?n=c:(i(e,a),n=a),d(),t=l.b.create({dump:function(){console.log(JSON.stringify(i(e),null,2))},toggleUpdates:function(){r?clearInterval(r):d()},get length(){return n.length},get list(){return n},get first(){return n[0]||void 0},exists:function(e){return!!n.find((function(t){return t.uuid===e}))},find:function(e){return n.find((function(t){return t.uuid===e}))||void 0},filter:function(e){return n.filter(e)},clear:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.length;n=a,t.persist(e)},create:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.push(e),t.persist(r),e},createget:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.find(e);return void 0===i&&((i=l.b.create(o,r)).uuid=e,n.push(i),t.persist(a)),i},delete:function(r){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("function"==typeof r)t.filter(r).forEach((function(e){t.delete(e.uuid,!1)})),t.persist(a);else if("string"==typeof r){var i=n.findIndex((function(e){return e.uuid===r}));if(!(i>-1))throw"ERROR ! DB.".concat(e,".delete failed. ").concat(r," not found");n.splice(i,1),t.persist(a)}},update:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.find(n);if(null===i)throw"ERROR ! DB.".concat(e,".update failed. ").concat(n," not found");return l.b.deepassign(i,r),t.persist(a),i},persist:function(t){if(t){if(!i(e,n))throw"ERROR ! DB.".concat(e,".persist failed");s=!1}else s=!0}})};function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var p="Boards Games Options Usage".split(" "),f={Usage:[{uuid:"0",laststart:Date.now(),lastend:Date.now(),usage:0}],Options:[c],Boards:[l.b.clone(u.a.templates.board,{uuid:"default"})],Games:[l.b.clone(u.a.templates.game,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Array.from(u.a.templates.plays).find((function(e){return"x-x"===e.mode})),{turn:-1,uuid:"default"}))]},m={scheme:"2020-06-24a",dump:function(){var e=JSON.stringify(m.all(),null,2);return e.replace(/\\"/g,"'")},all:function(){return{scheme:i("scheme"),usage:i("Usage"),options:i("Options"),boards:i("Boards"),games:i("Games")}},reset:function(){console.log("Info   :","Caissa first use, resetting DB...","scheme",m.scheme),i.clear(),i("scheme",m.scheme),p.forEach((function(e){m[e]=d(e,f[e],u.a.tableTemplates[e])})),o.c.route("/menu/"),location.reload()},init:function(){try{if(s.a.localStorage||console.error("Info   :","BE","localStorage not available"),i("Usage")){m.scheme!==i("scheme")&&console.warn("WARN   :","New Scheme detected, please reset DB"),p.forEach((function(e){m[e]=d(e,f[e],u.a.tableTemplates[e])}));var e=m.Usage.first,t=m.Options.first,n=l.b.msecs2human(Date.now()-e.lastend);e.usage+=1,e.laststart=Date.now(),m.Usage.update("0",{usage:e.usage,laststart:Date.now()}),console.log("Info   :","DB",m.scheme,m.Games.length,"games","user:",t["user-data"].name,"usage:",e.usage,"last:",n,"ago")}else m.reset()}catch(e){console.error("DB.init.error",e)}}};m.init();t.a=m},QfWi:function(e,t,n){"use strict";n.r(t),function(e,t){n("iPZ8"),n("kypl"),n("KcJv"),n("XJHa"),n("NO6N"),n("pCzD"),n("aNIS"),n("u1l9"),n("UHK9"),n("qO//"),n("ag/i"),n("26qs"),n("XXOr"),n("NISO"),n("11tc"),n("hi3g"),n("KnrE"),n("7qfE"),n("C4nn"),n("lYjL"),n("IlJM"),n("FWxf"),n("Se8w"),n("SJSz"),n("RtS0"),n("4owi"),n("IvQZ"),n("uQK7"),n("o5JG"),n("/YXa"),n("8cZI"),n("8rZV"),n("lmye"),n("hTH9"),n("x3Br"),n("8Av2"),n("Tsb7"),n("WB5j"),n("lAJ5"),n("aOEW"),n("v+MS"),n("Xlt+"),n("bEJU"),n("RsBt"),n("F4s9"),n("op7M"),n("JT/7"),n("1sJv"),n("6QkG"),n("pKr/"),n("RWcT"),n("X21e"),n("ZXyM"),n("GCui"),n("iXYm"),n("D/wG"),n("Ut8V"),n("1Z5j"),n("1Qwx"),n("pJGf"),n("ArYU"),n("NZIh"),n("526l"),n("akAd"),n("JLHK"),n("ekdp"),n("IfeN"),n("Pe4Z"),n("TlnR"),n("wObw"),n("Rl66"),n("eUWX"),n("uAsx"),n("VyG4"),n("uJcu"),n("aR7f"),n("x+Sn"),n("fp7Y"),n("xeeI"),n("Pgdl"),n("ydrk"),n("SQIU"),n("i+rb"),n("ZJUF"),n("Nfll"),n("LW6M"),n("+XsM"),n("ZEAQ"),n("6uKX"),n("wCa+"),n("wk30"),n("PTK/"),n("c5sl"),n("EQuw"),n("dhi5"),n("zSSO"),n("u/xS"),n("ZrY6"),n("PM3k"),n("m37F"),n("Y4kN"),n("o9/u"),n("yEA/"),n("1ihM"),n("hKfv"),n("FOvO"),n("SUr3"),n("E/vp"),n("S/BG"),n("o29/"),n("RrfL"),n("4GBK"),n("JBxO"),n("JjHl"),n("St4I"),n("yPLR"),n("FdtR"),n("Ffmu"),n("QDHd"),n("oLsI"),n("AHPp"),n("bggm"),n("L0xw"),n("enkF"),n("i6eu"),n("dQW1"),n("hMrN"),n("9R9e"),n("YVp5"),n("btft"),n("NRL2"),n("SB7D"),n("CfbV"),n("Muwe"),n("M9Nf"),n("9UJh"),n("RsMT"),n("VyTv"),n("dYvz"),n("6Uyv"),n("4NM0"),n("WoWj"),n("w13K"),n("9yb3"),n("uXbS"),n("e+qc"),n("ZAKC"),n("chvs"),n("y89P"),n("X5mX"),n("aZFp"),n("MTDe"),n("SgDD"),n("F28z"),n("W7E7"),n("zSDB"),n("mslO"),n("HAuY"),n("D5rU"),n("6lz5"),n("jqTn"),n("eyPT"),n("ApFe"),n("y8Ly"),n("YySF"),n("Kxz6"),n("DnCL"),n("veAN"),n("D0Fs"),n("APoS"),n("uTy6"),n("pY4j"),n("Nu6h"),n("kPpV"),n("q2Qn"),n("W9dP"),n("OlPo"),n("/usm"),n("HJh7"),n("BqNe"),n("HKDy"),n("OgzJ"),n("lCat"),n("EApN"),n("0w+R"),n("MFGm"),n("lZgT"),n("JzGb"),n("WH+p"),n("xg3p"),n("soU3"),n("/xTX"),n("ajWl"),n("s5En"),n("EjQN"),n("36lJ"),n("fD/E"),n("LWud"),n("AxL9"),n("HztR"),n("xmYR"),n("cF0Y"),n("qoNQ"),n("rTzs"),n("3dw1"),n("U00V"),n("F9vW"),n("qwoB"),n("4SRy"),n("9DLp"),n("f5ON"),n("SeWL"),n("wcNg"),n("w//1"),n("jLTt");var r=n("hpu3");e.hot;try{var a=document.body.querySelector(".root");window.Caissa=r.c,r.c.onafterImport("production"),t.route.prefix="#!",t.route(a,r.a,r.b)}catch(e){console.error("index.js",e)}}.call(this,n("Ono3")(e),n("mjLj"))},Qie3:function(e,t,n){"use strict";(function(e){var r=n("0iYD"),a=n("B1qE");function i(t){return t.moves.reduce((function(e,t){return"w"===t.color?e.push([t]):e[e.length-1].push(t),e}),[]).map((function(n,r){return innerWidth>=720?e(a.a,{game:t,num:r+1,white:{move:n[0]},black:{move:n[1]||{piece:"",fen:"",flags:{},san:"",cp:0}}}):e(a.b,{game:t,num:r+1,white:{move:n[0]},black:{move:n[1]||{piece:"",fen:"",flags:{},san:"",cp:0}}})}))}var o=r.a.create("Moves",{view:function(t){return innerWidth>=720?e("div.gm-moves.flex-shrink",e("table.w-100.collapse",i(t.attrs.game))):e("div.gm-moves",{style:"margin: 1rem"},i(t.attrs.game))}});t.a=o}).call(this,n("mjLj"))},SBU7:function(e,t,n){"use strict";(function(e){var r=n("qxKj"),a=n("Jnlq"),i=n("0iYD"),o=n("4Glx"),s=n("Dpii"),c=a.b.interprete,u="",l=i.a.create("Games",{oninit:function(e){var t=e.attrs.params.idx,n=void 0===t?0:t,a=r.a.find((function(e){return e.idx===~~n}));console.log("Games.oninit",n,a.caption),a.games.length?console.log("Games.oninit.cachehit",~~n,a.caption):a.fetch().then((function(){console.log("Games.oninit.loaded",~~n,a.games.length),a.progress=0}))},view:function(t){var n=t.attrs,a=n.params.idx,i=void 0===a?0:a,l=n.className,d=n.style,h=r.a.find((function(e){return e.idx===~~i}));if(h.games.length){var p=h.games.filter((function(e){return!u.length||e.searchtext.includes(u)}));return e("div.page.games",{className:l,style:d},[e(s.j,u.length?c(h.header)+"[".concat(p.length,"/").concat(h.games.length,"]"):c(h.header)+"[".concat(h.games.length,"]")),e(s.h,{oninput:function(e){u=e.target.value.toLowerCase()}}),e(o.a,{games:p})])}return h.fetch().then((function(){h.progress=0})),e("div.page.games",{className:l,style:d},e(s.c,[e("img.source-icon",{src:h.icon}),e("div.source-caption.f4",h.caption),e("div.source-subline.f5.ellipsis",h.subline),h.games.length?e("div.games-loaded",h.games.length+" games loaded"):"",h.error?e("div.source-error.f5.mv1",h.error):"",h.progress?e("div.source-progress-on",{style:"width: ".concat(h.progress,"%;")}):e("div.source-progress-off")]))}});t.a=l}).call(this,n("mjLj"))},TqsC:function(e,t,n){"use strict";(function(e){var r=n("0iYD"),a=null,i=r.a.create("Last",{onregister:function(e){a=e},view:function(){return e("div.last.dn")},onupdate:function(e){var t=e.attrs.msecs;setTimeout((function(){return a.send("onafterupdates",{msecs:t})}))},oncreate:function(e){var t=e.attrs.msecs;setTimeout((function(){return a.send("onafterupdates",{msecs:t})}))}});t.a=i}).call(this,n("mjLj"))},"UN+b":function(e,t,n){"use strict";(function(e){var r=n("nxTg"),a=n.n(r),i=n("dU0s"),o=n("0iYD"),s=n("Wwkf"),c=n("Jnlq"),u=n("hpu3"),l=n("Ehzf"),d=o.a.create("Navigation",{view:function(t){var n=t.attrs.route,r=i.b[n].navi,o=function(e,t){return function(n){n.redraw=!1,l.a.hide(),Object(c.a)("#toggle-mobile-menu").checked=!1,u.c.route(e,t)}};return e("nav",[e("label",{"aria-label":"Menu",onclick:function(e){e.redraw=!1,u.c.route("/menu/")}},e("i.hamburger.fa.fa-bars "),e("span.home.f4.fiom.white.pl3","Caissa")),e("input[type=checkbox]",{id:"toggle-mobile-menu",oninput:function(e){e.redraw=!1,e.target.checked&&l.a.show((function(){Object(c.a)("#toggle-mobile-menu").checked=!1}))}}),e("ul",Array.from(s.a.navigation).map((function(t){var n=a()(t,3),i=n[0],s=n[1],c=n[2];return e("li",{onclick:o(i,s),class:i.startsWith(r)?"selected":"unselected"},c)})))])}});t.a=d}).call(this,n("mjLj"))},UdF5:function(e,t,n){},Wwkf:function(e,t,n){"use strict";var r=n.p+"images/chessboard-sprite.029b07f9.svg",a=n("wOn7"),i=n("Jnlq"),o=n("wyeM"),s={uuid:"G0000000",mode:"h-h",turn:-1,moves:[],score:{maxcp:0,maxmate:0},header:{White:"White",Black:"Black",Event:"",Site:"caissa.js.org",Round:"",Date:"",Result:"",Termination:"",TimeControl:""},pgn:""},c={uuid:"B0000000",fen:"",moveStart:"",bestmove:{move:{from:"",to:""},ponder:{from:"",to:""}},captured:{white:[],black:[]},orientation:a.a.white,buttons:{rotate:!0,backward:!0,forward:!0,left:!0,right:!0,play:!1,pause:!1,evaluate:!0},flags:{turn:"",over:!1,chck:!1,mate:!1,draw:!1,stal:!1,insu:!1,repe:!1},illustrations:{}};t.a=i.b.deepFreezeCreate({fens:{empty:"8/8/8/8/8/8/8/8 w - - 0 1",start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},opponents:{h:"Human",l:"Leela",s:"Stockfish"},database:{updateInterval:6e4},templates:{move:{turn:null,fen:"",from:"",to:"",color:"",piece:"",san:""},game:s,board:c,plays:[{mode:"h-h",uuid:"P0000000",subline:"a classic",header:{White:"",Black:""}},{mode:"x-x",uuid:"P1000000",subline:"no pressure",header:{White:"White",Black:"Black"}},{mode:"s-s",uuid:"P2000000",subline:"this is fun",header:{White:"Stockfish",Black:"Stockfish"}},{mode:"h-s",uuid:"P3000000",subline:"beat the machine",header:{White:"Human",Black:"Stockfish"}},{mode:"s-h",uuid:"P4000000",subline:"beat the machine",header:{White:"Stockfish",Black:"Human"}}]},tableTemplates:{Games:s,Boards:c},pieces:{fens:{white:"PPPPPPPPRNBQKBNR",black:"pppppppprnbqkbnr",sorted:"kqrbnp"},font:{k:"l",q:"w",r:"t",b:"n",n:"j",p:"o",K:"l",Q:"w",R:"t",B:"n",N:"j",P:"o"}},pagecache:{size:5},navigation:[["/sources/",{ico:"fa-chess-queen"},"PGNS"],["/games/",{src:o.a},"GAMES"],["/game/",{src:o.a},"GAME"],["/plays/",{src:o.a},"PLAY"],["/system/:module/",{ico:"fa-microchip",module:"system"},"SYSTEM"],["/options/",{ico:"fa-cogs"},"OPTIONS"]],apis:[{idx:1,caption:"api.chess.com/pub/player/",value:"https://api.chess.com/pub/player/noiv/games/2020/04/pgn"},{idx:2,caption:"lichess.org/api/games/user",value:"http://localhost:3000/static/games.pgn"},{idx:3,caption:"localhost:3000/static/games.few.pgn",value:"http://localhost:3000/static/games.few.pgn"},{idx:4,caption:"localhost:3000/static/games.pgn",value:"http://localhost:3000/static/games.pgn"}],openings:[{idx:1,caption:"OP01",value:"OP01"},{idx:2,caption:"OP02",value:"OP02"},{idx:3,caption:"OP03",value:"OP03"}],timecontrols:[{idx:0,caption:"10 secs + 0",value:"".concat(1e4,"+0")},{idx:1,caption:" 1 min  + 0",value:"".concat(6e4,"+0")},{idx:2,caption:" 5 min  + 0",value:"".concat(3e5,"+0")},{idx:3,caption:"10 min  + 0",value:"".concat(6e5,"+0")}],plays:{difficulties:{0:"looser",3:"rooky",5:"beginner",10:"experienced",20:"hardcore",30:"no chance"},defaults:[{uuid:"00000001",mode:"h-s",time:10,depth:3,subline:"play white against Stockfish"},{uuid:"00000002",mode:"s-h",time:10,depth:3,subline:"play black against Stockfish"},{uuid:"00000003",mode:"s-s",time:10,depth:3,subline:"this is fun"}]},board:{config:{position:"empty",orientation:a.a.white,style:{cssClass:"gray",showCoordinates:!1,showBorder:!1},sprite:{url:r,grid:40,markers:["marker4","marker5"]},responsive:!0,animationDuration:300,moveInputMode:a.e.dragPiece}},flagTitles:{n:"a non-capture",b:"a pawn push of two squares",e:"an en passant capture",c:"a standard capture",p:"a promotion",k:"kingside castling",q:"queenside castling",pc:"capture + promotion"},flagColors:{w:{n:"#fff",b:"darkgreen",e:"darkgreen",c:"darkred",p:"red",k:"darkgreen",q:"darkgreen",pc:"orange"},b:{n:"#333",b:"darkgreen",e:"darkred",c:"darkred",p:"red",k:"darkgreen",q:"darkgreen",pc:"orange"}}})},ZIMq:function(e,t,n){"use strict";(function(e){var r,a,i,o,s=n("nxTg"),c=n.n(s),u=n("hpu3"),l=n("Jnlq"),d=n("vdVe"),h=n("0iYD"),p=n("dU0s"),f=n("Mebt"),m=n("sK7Z"),v=f.a.transitionEnd,g=h.a.create("Pages",{oninit:function(){m.a.listen()},onbeforeupdate:function(){m.a.pause()},onremove:function(){m.a.remove()},onresize:function(e,t){i="translateX(    0)",e<360?(a=e,"translateX( 100vw )",o="translateX( calc(2*100vw) )"):(a=360,"translateX( 360px )",o="translateX( 720px )")},view:function(){var t=d.a.slides(),n=c()(t,1)[0],a=c()(n,4),i=a[0],o=a[1],s=a[2],u=a[3];return d.a.log(),console.log("PAGES.view",n.slice(0,3).map((function(e){return e.content.name})),u),r=u,e("div.pages",{},p.a.map((function(t){var n=i.content===t,r=o.content===t,a=s.content===t,c=Object(l.a)("div.page."+t.name.toLowerCase());return n&&a&&console.log("gotcha"),n||r||a?(t.preventUpdates=!1,c&&(c.classList.remove("dn"),n&&(c.classList.add("slide","left","trans-left"),c.setAttribute("style","z-index: 12")),r&&(c.classList.add("slide","center","trans-center"),c.setAttribute("style","z-index: 11;")),a&&(c.classList.add("slide","right","trans-right"),c.setAttribute("style","z-index: 12;")))):(t.preventUpdates=!0,c&&(c.classList.remove("slide","left","center","right","trans-left","trans-center","trans-right"),c.classList.add("dn"),c.removeAttribute("style"))),n?e(i.content,{route:i.route,params:i.params,className:"slide left trans-left",style:"z-index: 12;"}):r?e(o.content,{route:o.route,params:o.params,className:"slide center trans-center",style:"z-index: 11;"}):a?e(s.content,{route:s.route,params:s.params,className:"slide right trans-right",style:"z-index: 12;"}):e(t,{route:"",params:{},className:"dn"})})))},onafterupdates:function(){var e=Object(l.a)("div.slide.left"),t=Object(l.a)("div.slide.center"),n=Object(l.a)("div.slide.right");console.log("pages.onafterupdates.in",!!e,!!t,!!n,r),"=1="===r||"=r="===r||"=s="===r||"=w="===r?(e&&(e.classList.remove("trans-right","trans-center"),e.classList.add("trans-left")),n&&(n.classList.remove("trans-left","trans-center"),n.classList.add("trans-right")),(d.a.canBack||d.a.canFore)&&m.a.init(i,o,a)):"=b>"===r?e&&(e.addEventListener(v,b),e.classList.remove("page-slide","trans-left"),e.classList.add("page-slide","trans-center")):"<c="===r||"<f="===r?n&&(n.addEventListener(v,b),n.classList.remove("page-slide","trans-right"),n.classList.add("page-slide","trans-center")):"=b="===r||"=f="===r?u.c.redraw():console.warn("pages.onafterupdates.unknown anim",r)}});function b(){var e=Object(l.a)("div.slide.left"),t=Object(l.a)("div.slide.right");"<c="===r||"<f="===r?(t.removeEventListener(v,b),t.classList.remove("page-slide","trans-right"),t.classList.add("trans-center")):"=b>"===r&&(e.removeEventListener(v,b),e.classList.remove("page-slide","trans-left"),e.classList.add("trans-center")),console.log("pages.onafteranimate.out",r),console.log(" "),r="",u.c.redraw()}t.a=g}).call(this,n("mjLj"))},bdsc:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var r=n("hpu3"),a=n("QH1x"),i=n("Jnlq"),o=n("Mebt"),s=n("NthX"),c=n.n(s),u=n("fFdx"),l=n.n(u),d=n("SDJZ"),h=n.n(d),p=n("NToG"),f=n.n(p),m=n("geNu"),v=n.n(m),g=n("vVKl"),b={cmdType:/^(id|option|uciok$|info|bestmove|Stockfish)/,id:/^id (name|author) (.+)$/,option:/^option name (.+) type (\w+)(?: default ([A-Za-z0-9._\\\:<>/]+))?(?: min (-?\w+))?(?: max (-?\w+))?(?: var (.+))*$/,bestmove:/^bestmove ([A-Za-z0-9\(\)]+)(?: ponder (\w+))?$/,info:{depth:/\bdepth (\d+)/,seldepth:/\bseldepth (\d+)/,time:/\btime (\d+)/,nodes:/\bnodes (\d+)/,currmove:/\bcurrmove (\w+)/,currmovenumber:/\bcurrmovenumber (\d+)/,hashfull:/\bhashfull (\d+)/,nps:/\bnps (\d+)/,tbhits:/\btbhits (\d+)/,cpuload:/\bcpuload (\d+)/,score:/\bscore (cp|mate|lowerbound|upperbound) (-?\d+)/,multipv:/\bmultipv (\d+)/,pv:/\bpv (.+)/,string:/\bstring (.+)/,refutation:/\brefutation (.+)/,currline:/\bcurrline (.+)/}},w=["depth","seldepth","time","nodes","currmovenumber","hashfull","nps","tbhits","cpuload","multipv"];function y(e){var t="go";return["searchmoves","ponder","wtime","btime","winc","binc","movestogo","depth","nodes","mate","movetime","infinite","time"].forEach((function(n){if(void 0!==e[n])switch(n){case"searchmoves":e[n].length&&(t+=" searchmoves "+e[n].join(" "));break;case"ponder":case"infinite":e[n]&&(t+=" ".concat(n));break;default:e[n]>=0&&(t+=" ".concat(n," ").concat(e[n]))}})),t}function k(e){var t=b.bestmove.exec(e);if(t&&t[1]){var n={bestmove:t[1]};return t[2]&&(n.ponder=t[2]),n}}var x=n("nxTg"),O=n.n(x);function P(e){for(var t={},n=0,r=Object.entries(b.info);n<r.length;n++){var a=O()(r[n],2),i=a[0],o=a[1].exec(e);if(o)switch(i){case"score":t[i]={unit:o[1],value:parseFloat(o[2])};break;default:w.includes(i)?t[i]=parseFloat(o[1]):t[i]=o[1]}}if(Object.keys(t).length)return t}function j(e,t){var n=b.cmdType.exec(t);if(!n)return console.log("goReducer.unkown",t),e;switch(n[1]){case"bestmove":var r=k(t);r.bestmove&&(e.bestmove=r.bestmove),r.ponder&&(e.ponder=r.ponder);break;case"info":var a=P(t);a&&e.info.push(a)}return e}var S=n("OvAC"),D=n.n(S);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){D()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t){var n=b.cmdType.exec(t);if(!n)return console.log("initRecucer.unkown",t),e;switch(n[1]){case"id":e.id=M({},e.id,{},function(e){var t=b.id.exec(e);return t&&t[1]&&t[2]?D()({},t[1],t[2]):null}(t));break;case"option":e.options=M({},e.options,{},function(e){var t=b.option.exec(e);if(!t)return null;var n={type:t[2]};switch(t[2]){case"check":n.default="true"===t[3];break;case"spin":n.default=parseInt(t[3]),n.min=parseInt(t[4]),n.max=parseInt(t[5]);break;case"combo":n.default=t[3],n.options=t[6].split(/ ?var ?/g);break;case"string":n.default=t[3]}return D()({},t[1],n)}(t))}return e}var L=n("3EY0"),T=n.n(L),A=function(){function e(t){h()(this,e),this.slot=t,this.options=new Map,this.worker=new T.a}var t,n,r,a,i,o,s,u,d,p,m,w;return f()(e,[{key:"connect",value:function(){this.worker.onmessage=this.listener,this.worker.onerror=this.errorListener,this.worker.onmessageerror=this.errorListener}},{key:"listener",value:function(e){var t=e.data;console.log("engine.listener",t)}},{key:"errorListener",value:function(e){console.warn("engine.errorListener",e)}},{key:"write",value:function(e){g.a.log("engine","".concat(this.slot.name||"unknown",".").concat(this.slot.idx,".write: ")+e),this.worker.postMessage(e)}},{key:"getBufferUntil",value:(w=l()(c.a.mark((function e(t){var n,r,a,i,o=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],i=new Promise((function(e,i){r=function(r){var a=r.data;if((a=a.trim())&&(n.push(a),t(a)))return e()},a=function(e){console.warn("engine.getBufferUntil",e),i()},o.worker.onmessage=r,o.worker.onerror=a,o.worker.onmessageerror=a})),e.next=4,i;case 4:return this.connect(),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"init",value:(m=l()(c.a.mark((function e(){var t,n,r,a,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.connect(),this.write("uci"),e.next=4,this.getBufferUntil((function(e){return"uciok"===e}));case 4:return t=e.sent,n=t.reduce(I,{id:{},options:{}}),r=n.id,a=n.options,r&&(this.id=r),a&&Object.keys(a).forEach((function(e){i.options.set(e,a[e])})),e.abrupt("return",this);case 9:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"isready",value:(p=l()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.write("isready"),e.next=3,this.getBufferUntil((function(e){return"readyok"===e}));case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"sendCmd",value:(d=l()(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.worker){e.next=2;break}throw new Error('cannot call "'.concat(t,'()": worker not running'));case 2:return this.write(t),e.abrupt("return",this.isready());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"setoption",value:(u=l()(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="name "+t,void 0!==n&&(r+=" value ".concat(n.toString())),e.next=4,this.sendCmd("setoption "+r);case 4:return this.options.set(t,n),e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"ucinewgame",value:(s=l()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendCmd("ucinewgame"));case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"ponderhit",value:(o=l()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sendCmd("ponderhit"));case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"position",value:(i=l()(c.a.mark((function e(t){var n,r,a=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"",r="startpos"===t?"startpos":"fen "+t,n.length&&(r+=" moves "+n.join(" ")),e.abrupt("return",this.sendCmd("position "+r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"go",value:(a=l()(c.a.mark((function e(t){var n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.worker){e.next=2;break}throw new Error('cannot call "go()": worker not running');case 2:if(!t.infinite){e.next=4;break}throw new Error("go() does not support infinite search, use goInfinite()");case 4:return n=y(t),this.write(n),e.next=8,this.getBufferUntil((function(e){return b.bestmove.test(e)}));case 8:return r=e.sent,a=r.reduce(j,{bestmove:null,info:[]}),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"goInfinite",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.worker)throw new Error('cannot call "goInfinite()": worker not running');this.emitter=new v.a;var n=function(t){t.split(/\r?\n/g).filter((function(e){return!!e.length})).forEach((function(t){var n=P(t);if(n)return e.emitter.emit("data",n);var r=k(t);return r?e.emitter.emit("data",r):void 0}))};t.infinite=!0;var r=y(t);return this.proc.stdout.on("data",n),this.emitter.on("stop",(function(){e.proc.stdout.removeListener("data",n)})),this.write(r),this.emitter}},{key:"stop",value:(r=l()(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.emitter){e.next=2;break}throw new Error('cannot call "stop()": goInfinite() is not in progress');case 2:return this.write("stop"),this.emitter.emit("stop"),e.next=6,this.getBufferUntil((function(e){return b.bestmove.test(e)}));case 6:return t=e.sent,n=t.reduce(j,{bestmove:null,info:[]}),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"evaluate",value:(n=l()(c.a.mark((function e(t){var n,r,a,i=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{depth:3,maxtime:1},e.next=3,this.isready();case 3:return e.next=5,this.position(t.fen);case 5:return e.next=7,this.go(n);case 7:r=e.sent,"cp"===(a=r.info.slice(-1)[0]).score.unit&&(t.cp=Math.abs(a.score.value)),"mate"===a.score.unit&&(t.mate=a.score.value),t.pv=a.pv;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"evaluateMoves",value:(t=l()(c.a.mark((function e(t,n,r){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0;case 1:if(!(a<t.length)){e.next=8;break}return e.next=4,this.evaluate(t[a],n);case 4:r(t[a]);case 5:a++,e.next=1;break;case 8:return e.abrupt("return",this);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),C=o.a.threads-1,B=new Array(C).fill(null).map((function(e,t){return{idx:t,idle:null,engine:null}})),q={sorter:function(e,t){return e&&e.idle&&null===t.engine||e&&e.idle&&t&&!t.idle?-1:t&&t.idle&&null===e.engine||t&&t.idle&&e&&!e.idle?1:0},prepare:function(e){return null===e.engine?(e.engine=new A(e),e.idle=!1,e):e.idle?(e.idle=!1,e):void console.log("WTF")},request:function(e){var t=B.filter((function(e){return null===e.engine||e.idle})).sort(q.sorter).slice(0,e).map(q.prepare);return t.length!==e&&console.warn("pool.request.failed",t.length,"/",e,B,t),t}},G=n("I75Z");function N(e){var t=Date.now(),n=(99-12*u)/e.moves.length,s=a.a.Options.first["game-evaluator"],c=~~s.maxdepth,u=~~s.maxthreads,l=i.b.partitions(e.moves,u),d=0,h=0;e.score.maxcp=0,e.score.maxmate=0,e.buttons.evaluate=!1,e.buttons.spinner=!0;var p={depth:c,time:s.maxsecs},f=function(e){h+=e,G.a.render(h)},m=function(t){d+=1,f(n),e.score.maxcp=Math.abs(t.cp)>e.score.maxcp?t.cp:e.score.maxcp,2%d||r.c.redraw()};console.log("game.evaluator.start",u,"/",o.a.threads,"depth",p.depth),G.a.render(4),Promise.all(q.request(u).map((function(e,t){return f(4),e.engine.init().then((function(e){return f(4),e.evaluateMoves(l[t],p,m)})).then((function(e){return f(4),e.slot}))}))).then((function(n){e.buttons.evaluate=!0,e.buttons.spinner=!1,n.forEach((function(e){return e.idle=!0})),G.a.render(0),r.c.redraw(),console.log("game.evaluator.finish",e.moves.length,"moves in",Date.now()-t,"msecs","".concat(u,"/").concat(o.a.threads," threads"),"depth:",p.depth,n)}))}},c7Ff:function(e,t,n){},"cNH+":function(e,t,n){"use strict";(function(e){var r,a,i=n("hpu3"),o=n("Jnlq"),s=n("0iYD"),c=n("QH1x"),u=n("bdsc"),l=n("I75Z");function d(e){var t=r.turn;return"0"===e?0:"e"===e?r.moves.length-1:-2===t&&e<0?-2:t===r.moves.length-1&&e>0?r.moves.length-1:t+e}var h={back:function(e){e.redraw=!1,a.step(d("0"))},left:function(e){e.redraw=!1,a.step(d(-1))},right:function(e){e.redraw=!1,a.step(d(1))},fore:function(e){e.redraw=!1,a.step(d("e"))},pause:function(e){e.redraw=!1,a.pause()},play:function(e){e.redraw=!1,a.play()},eval:function(e){e.redraw=!1,Object(u.a)(r)},rotate:function(e){e.redraw=!1;var t="w"===c.a.Boards.find(r.uuid).orientation?"b":"w";c.a.Boards.update(r.uuid,{orientation:t}),i.c.redraw()}},p={backward:{onclick:h.back,title:"",tag:"i.gm-button.fa.fa-step-backward"},left:{onclick:h.left,title:"",tag:"i.gm-button.fa.fa-chevron-left"},play:{onclick:h.play,title:"",tag:"i.gm-button.fa.fa-play"},pause:{onclick:h.pause,title:"",tag:"i.gm-button.fa.fa-pause"},right:{onclick:h.right,title:"",tag:"i.gm-button.fa.fa-chevron-right"},forward:{onclick:h.fore,title:"",tag:"i.gm-button.fa.fa-step-forward"},evaluate:{onclick:h.eval,title:"",tag:"i.gm-button.fa.fa-poll-h"},spinner:{onclick:function(){},title:"",tag:"i.gm-spinner.fa.fa-spinner.fa-spin"},rotate:{onclick:h.rotate,title:"",tag:"i.gm-button.fa.fa-sync-alt"}},f=s.a.create("BoardButtons",{view:function(t){var n=t.attrs,i=n.game,s=n.board,c=n.controller;return console.log("BoardButtons.view",i.uuid,i.mode,i.turn),r=i,a=c,e("div.gm-bar",[e("div.gm-buttons.f3",o.b.map(p,(function(t,n){var r="spinner"===t&&s.buttons.evaluate?"dn":"spinner"!==t||s.buttons.evaluate?"evaluate"===t&&s.buttons.evaluate?"ctw80":"evaluate"!==t||s.buttons.evaluate?s.buttons[t]?"ctw80":"ctb10":"dn":"ctw80";return e(n.tag,{title:n.title,onclick:n.onclick,className:r})}))),e(l.a,{game:i})])}});t.a=f}).call(this,n("mjLj"))},cv7E:function(e,t,n){"use strict";var r=n("SDJZ"),a=n.n(r),i=n("NToG"),o=n.n(i),s=n("uoUx"),c=n.n(s),u=n("hpu3"),l=n("Wwkf"),d=n("QH1x"),h=n("Jnlq"),p=n("MqTa"),f=n("wOn7"),m=function(){function e(t,n){a()(this,e),this.color=t,this.mode=n}return o()(e,[{key:"update",value:function(e){this.fen=p.a.Games.fen(e.game),this.chess=new c.a,!this.chess.load(this.fen)&&console.warn("Opponent.update.load.failed",this.fen)}},{key:"tomove",value:function(e){this.update(e),this.movedone=e.onmovedone.bind(e),this.movestart=e.onmovestart.bind(e),this.movecancel=e.onmovecancel.bind(e)}},{key:"towait",value:function(e){this.update(e)}},{key:"dragHandler",value:function(e){var t,n;switch(e.type){case f.c.moveStart:return this.movestart(e.square),!0;case f.c.moveDone:if(t={from:e.squareFrom,to:e.squareTo},n=this.chess.move(t)){var r=this.chess.history({verbose:!0}).slice(-1)[0],a=this.chess.pgn().trim();r.fen=this.chess.fen(),this.movedone(r,a)}return!!n;case f.c.moveCanceled:this.movecancel()}}}]),e}(),v=function(){function e(t,n){a()(this,e),this.mode=t.mode,this.uuid=t.uuid,this.game=t,this.board=n,this.mode=t.mode,this.chess=new c.a,this.squareMoves=[],this.validMoves=[],this.opponents={w:new m("w",this.mode[0]),b:new m("b",this.mode[0]),n:{tomove:function(){},towait:function(){}}},this.update()}return o()(e,[{key:"update",value:function(e){this.turn=~~this.game.turn,this.fen=p.a.Games.fen(this.game),!this.chess.load(this.fen)&&console.warn("BoardController.update.load.failed",this.fen),this.color=this.chess.turn(),this.lastMove=this.game.moves.slice(-1)[0],this.validMoves=this.chess.moves({verbose:!0}),this.tomove=-2===this.turn?"n":this.turn%2?"w":"b",this.towait=-2===this.turn?"n":this.turn%2?"b":"w",this.updateFlags(),this.updateButtons(),e&&(this.chessBoard=e,this.updateIllustration(),this.listen())}},{key:"listen",value:function(){if(-2!==this.turn){var e=this.opponents[this.tomove],t=this.opponents[this.towait];if("x-x"===this.mode){var n=e.dragHandler.bind(e);this.chessBoard.enableMoveInput(n,this.color)}e.tomove(this),t.towait(this)}}},{key:"step",value:function(e){d.a.Games.update(this.game.uuid,{turn:e}),u.c.route("/game/:turn/:uuid/",{turn:e,uuid:this.game.uuid},{replace:!0})}},{key:"onfield",value:function(e){var t=e.target.dataset.index,n=p.a.Board.squareIndexToField(t);this.chessBoard.getPiece(n);this.squareMoves=this.validMoves.filter((function(e){return e.from===n||e.to===n})),this.updateIllustration()}},{key:"onmovecancel",value:function(){}},{key:"onmovedone",value:function(e,t){if(this.chess.move(e),"default"===this.game.uuid){var n=Date.now(),r=h.b.hash(String(n)),a=h.b.create(this.game,{uuid:r,mode:"x-x",turn:0,pgn:t,timestamp:n});p.a.Games.updateMoves(a),d.a.Games.create(a,!0),d.a.Boards.create(h.b.clone(l.a.templates.board,{uuid:r})),u.c.route("/game/:turn/:uuid/",{turn:a.turn,uuid:a.uuid})}else e.turn=this.turn+1,this.game.moves.push(e),this.game.turn=e.turn,d.a.Games.update(this.game.uuid,this.game,!0),u.c.route("/game/:turn/:uuid/",{turn:this.game.turn,uuid:this.game.uuid},{replace:!0})}},{key:"onmovestart",value:function(e){this.chessBoard.getPiece(e)}},{key:"updateFlags",value:function(){var e=this.board.flags,t=this.chess;e.turn=-2===this.turn?null:t.turn(),e.over=t.game_over(),e.chck=t.in_check(),e.mate=t.in_checkmate(),e.draw=t.in_draw(),e.stal=t.in_stalemate(),e.insu=t.insufficient_material(),e.repe=t.in_threefold_repetition()}},{key:"updateButtons",value:function(){var e=this.board.buttons,t=!this.isRunning&&"h-h"!==this.mode&&"x-x"!==this.mode,n=this.isRunning&&"h-h"!==this.mode&&"x-x"!==this.mode;e.rotate=!0,e.backward=this.turn>0,e.forward=this.turn<this.game.moves.length-1,e.left=this.turn>-2,e.right=this.turn<this.game.moves.length-1,e.play=t,e.pause=n,e.evaluate=this.game.moves.length>0&&!this.isRunning}},{key:"updateIllustration",value:function(){this.chessBoard&&this.chessBoard.view.height&&-2!==this.game.turn&&(this.updateArrows(),this.updateMarker())}},{key:"updateArrows",value:function(){var e=this;if(this.chessBoard.removeArrows(null),this.board.illustrations.valid&&this.squareMoves.forEach((function(t){e.chessBoard.addArrow(t.from,t.to,{class:"arrow validmove"})})),this.board.illustrations.last){var t=this.lastMove;this.chessBoard.addArrow(t.from,t.to,{class:"w"===t.color?"arrow last-white":"arrow last-black"})}this.board.illustrations.test&&(this.chessBoard.addArrow("e2","e4",{class:"arrow test"}),this.chessBoard.addArrow("f2","h4",{class:"arrow test"}),this.chessBoard.addArrow("d2","c4",{class:"arrow test"}),this.chessBoard.addArrow("c2","a3",{class:"arrow test"}),this.chessBoard.addArrow("d7","d5",{class:"arrow test"}),this.chessBoard.addArrow("c7","c5",{class:"arrow test"}),this.chessBoard.addArrow("g7","g8",{class:"arrow test"}),this.chessBoard.addArrow("g7","h8",{class:"arrow test"}),this.chessBoard.addArrow("g7","h7",{class:"arrow test"}),this.chessBoard.addArrow("g7","h6",{class:"arrow test"}),this.chessBoard.addArrow("g7","g6",{class:"arrow test"}),this.chessBoard.addArrow("g7","f6",{class:"arrow test"}),this.chessBoard.addArrow("g7","f7",{class:"arrow test"}),this.chessBoard.addArrow("g7","f8",{class:"arrow test"}))}},{key:"updateMarker",value:function(){var e=this,t="w"===this.color?f.d.rectwhite:f.d.rectblack;this.chessBoard.removeMarkers(null,null),this.board.illustrations.attack&&this.validMoves.forEach((function(n){e.chessBoard.addMarker(n.to,t)}))}}]),e}();t.a=v},dU0s:function(e,t,n){"use strict";n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return m}));var r=n("u6GA"),a=n("t7ig"),i=n("n8lb"),o=n("SBU7"),s=n("kbMm"),c=n("lJ9B"),u=n("9ubP"),l=n("JSL1"),d=n("nkYS"),h=n("Dpii"),p=n("Jnlq"),f="/menu/",m=[a.a,l.a,o.a,u.a,s.a,i.a,d.a],v=p.b.create({"/menu/":[r.a,a.a,c.a,{navi:"/menu/",title:"Menu"}],"/sources/":[r.a,l.a,c.a,{navi:"/sources/",title:"Sources"}],"/games/":[r.a,o.a,c.a,{navi:"/games/",title:"Games"}],"/games/:idx/":[r.a,o.a,c.a,{navi:"/games/",title:"Games %s"}],"/game/:turn/:uuid/":[r.a,u.a,c.a,{navi:"/game/",title:"Game %s"}],"/plays/":[r.a,s.a,c.a,{navi:"/plays/",title:"Plays"}],"/plays/:mode/":[r.a,s.a,c.a,{navi:"/plays/",title:"Plays"}],"/options/":[r.a,i.a,c.a,{navi:"/options/",title:"Options"}],"/system/":[r.a,d.a,h.i,{navi:"/system/",title:"System"}],"/system/:module/":[r.a,d.a,h.i,{navi:"/system/",title:"System %s"}]})},e3Qi:function(e,t,n){"use strict";(function(e){var r=n("OvAC"),a=n.n(r),i=n("0iYD"),o=n("97EL"),s=n("QH1x");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var u=i.a.create("FormIllus",{view:function(t){var n=t.attrs.board,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.illustrations,{group:"board-illustrations",autosubmit:!0,submit:function(){console.log(r),delete r.group,delete r.submit,delete r.autosubmit,s.a.Boards.update(n.uuid,{illustrations:r})}});return e(o.a,{formdata:r,noheader:!1,style:"background: #658199",className:"default-options group-board-illustrations"})}});t.a=u}).call(this,n("mjLj"))},hpu3:function(e,t,n){"use strict";(function(e,r){n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return y}));var a=n("nxTg"),i=n.n(a),o=n("OvAC"),s=n.n(o),c=n("Jnlq"),u=n("Mebt"),l=n("vVKl"),d=n("QH1x"),h=n("CNX3"),p=n("0iYD"),f=n("vdVe"),m=n("dU0s");function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n.d(t,"a",(function(){return m.c}));var b=50,w={H:c.b,DB:d.a,System:u.a,dumpDB:function(){var e=d.a.dump(),t=document.body;t.style.whiteSpace="pre",t.style.background="white",t.style.overflow="auto",t.style.color="black",t.style.fontFamily="monospace",document.body.innerText=e},onafterImport:function(t){w.Env=t[0].toUpperCase()+t.substring(1),l.a.log("caissa","onafterImport",e),console.log("Info   :",w.Env,"loaded imports after",Date.now()-window.t0,"msecs"),h.a.listen()},onComponentCreated:function(e){setTimeout((function(){Object(c.a)("loader-screen .messages").innerHTML+="<br>"+e.name}),b+=16)},start:function(){document.body.removeChild(Object(c.a)("loader-container"))},onload:function(){l.a.log("caissa","onload");var e=Date.now()-window.t0;e>2e3?console.warn("Warn   :","... done after",0,e,"msecs"):console.log("Info   :","... done after",0,e,"msecs"),d.a.Options.first.ui.waitscreen?(Object(c.a)("loader-screen .group2").style.display="inline-block",Object(c.a)("loader-screen .group3").style.display="inline-block",Object(c.a)("loader-screen .group4").style.display="inline-block",Object(c.a)("loader-screen .group5").style.display="inline-block",Object(c.a)("loader-screen .dump").style.display="inline-block",Object(c.a)('loader-screen input[type="checkbox"]').checked=!0,Object(c.a)('loader-screen input[type="text"]').value=d.a.Options.first["user-data"].name):document.body.removeChild(Object(c.a)("loader-container")),window.onerror=function(){console.warn("Error :",arguments)},window.onunhandledrejection=function(e){e.preventDefault(),console.warn("Error :",e.type,e.reason,e)},console.log(" ")},redraw:function(){console.log(" "),f.a.prepare("",{},{redraw:!0}),r.redraw()},route:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{replace:!1};console.log(" "),console.log("%cCaissa.route.in %s %s %s","color:darkred; font-weight: 800",e,c.b.shrink(t),c.b.shrink(n));var a=m.b[e];a?(f.a.prepare(e,t,n),r.route.set(e,t,g({title:a.title},n))):console.warn("caissa.route.error",e,t,n)},resolver:function(e,t){return{onmatch:function(t){try{var n=r.buildPathname(e,t),a=f.a.isCurrent(n)?"current":"new";console.log("%cCaissa.onmatch.in %s %s ","color:darkblue; font-weight: 800",n,a),f.a.prepare(e,t)}catch(e){console.log(JSON.stringify(e),e)}},render:function(n){var a=t[1],i=r.buildPathname(e,n.attrs),o=f.a.isCurrent(i)?"current":"new";return console.log("%cCaissa.render.in %s %s","color:darkorange; font-weight: 800",i,o),f.a.finalize(e,n.attrs,a),r(w.comp,{route:e,params:n.attrs})}}},comp:p.a.create("Caissa",{view:function(e){var t=e.attrs,n=t.route,a=t.params,o=i()(m.b[n],4),s=o[0],c=o[1],u=o[2],l=o[3],d=r.buildPathname(n,a);return console.log("%cCaissa.view.in %s %s","color:darkgreen; font-weight: 800",d,f.a.animation),document.title=l.title,r(s,{route:n,params:a},[c,u])}})},y=c.b.transform(m.b,w.resolver)}).call(this,n("5IsQ"),n("mjLj"))},j26v:function(e,t,n){},jLTt:function(e,t,n){},kbMm:function(e,t,n){"use strict";(function(e){var r=n("OvAC"),a=n.n(r),i=n("hpu3"),o=n("QH1x"),s=n("Jnlq"),c=n("0iYD"),u=n("97EL"),l=n("Wwkf"),d=n("MqTa"),h=n("Dpii");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var f={},m=function(e){return"h-h"!==e.mode};Array.from(l.a.templates.plays).filter(m).forEach((function(e){var t="play-"+e.mode,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({group:t,autosubmit:!1},o.a.Options.first[t],{submit:function(t){var n=d.a.Games.fromPlayForm(e,t);o.a.Games.create(n,!0),o.a.Boards.create(s.b.clone(l.a.templates.board,{uuid:n.uuid})),console.log("plays.form.submitted",n.uuid,n.mode,n.white,n.black),i.c.route("/game/:turn/:uuid/",{uuid:n.uuid,turn:n.turn})}});f[e.mode]=n}));var v=c.a.create("Plays",{view:function(t){var n=t.attrs,r=n.className,a=n.style,c=t.attrs.params.mode;return e("div.page.plays",{className:r,style:a},[e(h.j,"Start a new Game"),e(h.g,"Play with Machines"),e(h.a,Array.from(l.a.templates.plays).filter(m).map((function(t){var n=f[t.mode],r=c===t.mode?{marginBottom:"0px",backgroundColor:"#0e62993b",color:"white"}:{};return e("[",[e(h.c,{onclick:function(e){return"x-x"===e.mode?function(t){var n,r;t.redraw=!1,n=e,r=s.b.clone(l.a.templates.game,n,{turn:-1,uuid:s.b.hash(String(Date.now())),timestamp:Date.now()}),o.a.Games.create(r,!0),o.a.Boards.create(s.b.clone(l.a.templates.board,{uuid:r.uuid})),i.c.route("/game/:turn/:uuid/",{uuid:r.uuid,turn:r.turn})}:e.mode===c?function(e){e.redraw=!1,i.c.route("/plays/",{},{replace:!0})}:function(t){t.redraw=!1,i.c.route("/plays/:mode/",{mode:e.mode},{replace:!0})}}(t),style:r},[e("div.fiom.f4",t.header.White+" vs. "+t.header.Black),e("div.fior.f5",t.subline)]),t.mode===c?e(u.a,{formdata:n,noheader:!0,className:"play-options"}):e(h.i)])}))),e(h.g,"Resume a Game ("+o.a.Games.filter(m).length+")"),e(h.e,o.a.Games.filter(m).map((function(t){return e(h.d,{onclick:function(e){e.redraw=!1,i.c.route("/play/:uuid/",{uuid:t.uuid})},play:t})}))),e(h.k),e("button.pv1.mh3.mv1",{onclick:function(){return o.a.Games.delete(m)}},"DB.Plays.clear()"),e("button.pv1.mh3.mv1",{onclick:function(){return o.a.reset()}},"DB.reset()")])}});t.a=v}).call(this,n("mjLj"))},lJ9B:function(e,t,n){"use strict";(function(e){n("0YGP");var r,a,i,o,s,c=n("0iYD"),u=n("QH1x"),l=n("MqTa"),d=n("mR8U"),h=n("cNH+"),p=n("mne2"),f=n("11NM"),m=n("cv7E"),v=c.a.create("Board",{view:function(t){var n=t.attrs.params,c=n.uuid,v=void 0===c?"default":c,g=n.turn,b=void 0===g?-1:g;"default"===v&&a&&(v=a,b=r),v!==a?(console.log("Board.view.newgame",{uuid:v,turn:b},"last:",a,r),i=u.a.Games.find(v),o=u.a.Boards.createget(v),u.a.Boards.update(v,{fen:l.a.Games.fen(i),captured:l.a.Games.captured(i),illustrations:u.a.Options.first["board-illustrations"]},!0),s=new m.a(i,o)):b!==r?(console.log("Board.view.newturn",{uuid:v,turn:b},"last:",a,r),u.a.Games.update(v,{turn:~~b},!0),u.a.Boards.update(v,{fen:l.a.Games.fen(i),captured:l.a.Games.captured(i),illustrations:u.a.Options.first["board-illustrations"]},!0),s.update()):console.log("Board.view.nochange",{uuid:v,turn:b},a,r),a=v,r=b;var w="w"===o.orientation?"w":"b",y="b"===o.orientation?"w":"b";return innerWidth>=720?e("[",[e(h.a,{game:i,board:o,controller:s}),e(p.a,{game:i,board:o,pos:"top",player:w}),e(f.a,{game:i,board:o,controller:s}),e(p.a,{game:i,board:o,pos:"bot",player:y}),e(d.a,{game:i,board:o})]):e("[",[e(d.a,{game:i,board:o}),e(f.a,{game:i,board:o,controller:s}),e(h.a,{game:i,board:o,controller:s})])}});t.a=v}).call(this,n("mjLj"))},m6vW:function(e,t,n){},mR8U:function(e,t,n){"use strict";(function(e){var r=n("Jnlq"),a=n("0iYD"),i=a.a.create("BoardFlags",{view:function(t){var n=t.attrs,a=n.game,i=n.board.flags;return e("div.gm-bar",e("div.gm-flags",r.b.map(function(e,t){var n,r,a;return-2===e.turn?n=r=a="ctb10":(n="ctb10 bg-trans",r="ctr20",a="w"===t.turn?"ceee":"c333"),{turn:{tag:"i.gm-flag.fa.fa-chess-queen",class:t.over?n:a,title:"turn"},chck:{tag:"i.gm-flag.fa.fa-plus",class:t.chck?a:n,title:"check"},mate:{tag:"i.gm-flag.fa.fa-hashtag",class:t.mate?a:n,title:"checkmate"},draw:{tag:"i.gm-flag.fa.fa-handshake",class:t.draw?r:n,title:"draw"},stal:{tag:"div.gm-flag.dib.mh1",class:t.stal?r:n,title:"stalemate"},insu:{tag:"i.gm-flag.fa.fa-hands",class:t.insu?r:n,title:"isufficient material"},repe:{tag:"i.gm-flag.fa.fa-list-ol",class:t.repe?r:n,title:"threefold repetition"},over:{tag:"i.gm-flag.fa.fa-chess-board",class:t.over?r:n,title:"game over"}}}(a,i),(function(t,n){return e(n.tag,{title:n.title,class:n.class})}))))}});t.a=i}).call(this,n("mjLj"))},mne2:function(e,t,n){"use strict";(function(e){var r=n("0iYD"),a=n("ohXN"),i=r.a.create("BoardBar",{view:function(t){var n=t.attrs,r=n.game,i=n.board,o=n.pos,s=n.player,c="letter-spacing: -8px; font-size: 1.5rem;";return e("div.flex.flex-row.board-bar-"+o,"w"===s?[e(a.a,{player:s}),e("div.flex-auto.mh2.saim.f4.c333.ellipsis",r.white),e("div.captured.tr.cfff",e("div.chess",{style:c},i.captured.white.join("")))]:[e(a.a,{player:s}),e("div.flex-auto.mh2.saim.f4.cfff.ellipsis",r.black),e("div.captured.tr.c333",e("div.chess",{style:c},i.captured.black.join("")))])}});t.a=i}).call(this,n("mjLj"))},n8lb:function(e,t,n){"use strict";(function(e){var r=n("OvAC"),a=n.n(r),i=n("5WRv"),o=n.n(i),s=(n("c7Ff"),n("QH1x")),c=n("97EL"),u=n("0iYD"),l=n("Dpii");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var h=u.a.create("Options",{view:function(t){var n=t.attrs,r=n.className,i=n.style,u=Object.keys(s.a.Options.first);return e("div.page.options",{className:r,style:i},[e(l.j,"Options"),e("div.viewport-y",o()(u.map((function(t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({group:t,autosubmit:!0},s.a.Options.first[t],{submit:function(){delete n.group,delete n.submit,delete n.autosubmit,s.a.Options.update("0",a()({},t,n),!0)}});return e(c.a,{formdata:n,noheader:!1,className:"default-options group-"+t})})))),e("div.mv1.ph3.w-100.tc.pv2",e("button.w-80.pv1",{style:"border-radius: 15px",onclick:function(){return s.a.reset()}},"Defaults"))])}});t.a=h}).call(this,n("mjLj"))},nkYS:function(e,t,n){"use strict";(function(e){n("ujPc");var r=n("hpu3"),a=n("Mebt"),i=n("Wwkf"),o=n("QH1x"),s=n("0iYD"),c=n("4VUy"),u=n("0MiI"),l={name:"Json",view:function(t){var n=t.attrs.tree;return e("div.w-100.viewport-y.h-100.bg-ccc",[e("div.f5.fior",{class:"json-tree"},[e(u.a,{tree:n,options:{collapseAfter:1}})])])}},d=s.a.create("System",{view:function(t){var n=t.attrs,s=n.params.module,u=n.className,d=n.style,h="config"===s?e(l,{tree:i.a}):"system"===s?e(l,{tree:a.a}):"db"===s?e(l,{tree:o.a.all()}):e(c.a),p=function(e){return function(t){t.redraw=!1,r.c.route("/system/:module/",{module:e},{replace:!0})}};return e("div.page.system",{className:u,style:d},[e("div.systemmenu.w-100.btb20",[e("ul.flex.flex-row.ml2","System Config DB Logs".split(" ").map((function(t){return e("li.ph2.pv1.f4.list.pointer",{onclick:p(t.toLowerCase())},t)})))]),h])}});t.a=d}).call(this,n("mjLj"))},ohXN:function(e,t,n){"use strict";(function(e){var r,a,i,o,s,c,u,l,d,h,p,f=n("Jnlq"),m=n("0iYD"),v={format:f.b.msec2HMS,time:0,pressure:!1},g={},b={},w=m.a.create("ChessClock",{start:function(e){a="w",s=e,u=0,c=0,l=5,i=Date.now(),Object.assign(g,v),Object.assign(b,v),o&&clearInterval(o),o=setInterval(w.tick,100),r=!0},stop:function(){clearInterval(o),r=!1},render:function(){e.render(h,w.white),e.render(d,w.black),e.render(p,w.total)},tick:function(){u+=1,c=Date.now()-i,g.time="w"===a?c-b.time:g.time,b.time="b"===a?c-g.time:b.time,s-g.time<1e4&&(g.format=f.b.msec2HMSm,g.pressure=!0,l=1),s-b.time<1e4&&(b.format=f.b.msec2HMSm,b.pressure=!0,l=1),(g.time>=s||b.time>=s)&&(g.time=g.time>s?s:g.time,b.time=b.time>s?s:b.time,w.render(),clearInterval(o),w.over&&w.over(g.time,b.time)),u%l||(w.ontick&&w.ontick(),w.render())},blackclick:function(){"b"===a&&(a="w")},whiteclick:function(){"w"===a&&(a="b")},white:function(){return r?g.format(s-g.time):"0:00:00"},black:function(){return r?b.format(s-b.time):"0:00:00"},total:function(){return r?f.b.msec2HMSm(c):"0:00:00"},oncreate:function(e){var t=e.attrs.player;"w"===t&&(h=e.dom),"b"===t&&(d=e.dom),"*"===t&&(p=e.dom),Object.assign(g,v),Object.assign(b,v)},view:function(t){var n=t.attrs.player,a=f.b.classes({white:"w"===n,black:"b"===n,total:"w"!==n&&"b"!==n,active:r,pressure:"w"===n&&g.pressure||"b"===n&&b.pressure}),i="w"===n?w.white():"b"===n?w.black():w.total();return e("div.clock",{className:a},i)}});t.a=w}).call(this,n("mjLj"))},pP2Y:function(e,t,n){"use strict";(function(e){n("8B4M");var r=n("T64k"),a=n.n(r),i=n("Mebt"),o=n("vdVe"),s=n("0iYD"),c=n("UN+b"),u=s.a.create("Header",{view:function(t){var n=t.attrs,r=n.route,s=n.params;return e("header",[e(c.a,{route:r,params:s}),o.a.canBack?e("i.navi.fa.fa-angle-left",{onclick:o.a.onback}):e("i.navi.fa.fa-angle-left.ctrans"),o.a.canFore?e("i.navi.fa.fa-angle-right",{onclick:o.a.onfore}):e("i.navi.fa.fa-angle-right.ctrans"),e("i.navi.fa.fa-retweet",{onclick:function(e){e.redraw=!1,window.location.reload()}}),e("i.navi.fa.fa-expand-arrows-alt",{onclick:function(e){e.redraw=!1,i.a.fullscreen&&a.a.toggle()}})])}});t.a=u}).call(this,n("mjLj"))},qxKj:function(e,t,n){"use strict";var r=n("xd8G"),a=n("+O/N"),i=n("UBKX"),o=n("zaI2"),s=n("QH1x"),c=n("OvAC"),u=n.n(c),l=n("Wwkf"),d=n("MqTa"),h=n("Jnlq"),p={readGames:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\n",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Date.now();e=e.replace(/\r/g,"").replace(/\t/g," "),n&&(e=e.replace(/\s?\{[^}]+\}/g,""));var r,a=[],i=e.split(t),o=h.b.clone(l.a.templates.game);return i.forEach((function(e){e=e.trim(),null!==(r=e.match(/^\[(\w+)\s+"(.*)"\]$/))&&"Event"===r[1]?(o.header.Event&&a.push(o),(o=h.b.clone(l.a.templates.game)).header[r[1]]=r[2]):null!==r?""!==r[2]&&(o.header[r[1]]=r[2]):e.length&&(o.pgn+=" "+e)})),o.header.Event&&a.push(o),a},sanitizeGames:function(e){return e.map((function(e){return e.uuid=d.a.Games.hash(e),e.date=e.header.Date?e.header.Date:e.header.EventDate?e.header.EventDate:e.header.UTCDate?e.header.UTCDate:"????.??.??",h.b.map(e.header,(function(t,n){!n&&delete e.header[t]})),e.searchtext=h.b.map(e.header,(function(e,t){return t})).join(" ").toLowerCase(),e.pgn,e}))}};function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){var t=m({},e,{error:"",progress:0,games:[],header:function(){return"".concat(t.caption," ")},fetch:function(){return t.progress=10,new Promise((function(n){t.games=p.readGames(e.source),t.progress=60,t.games=p.sanitizeGames(t.games),t.progress=0,n()}))}});return t},g=function(e){var t=m({},e,{error:"",progress:0,games:[],header:function(){return"".concat(t.games.length," downloaded Games")},fetch:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return t.progress=10,fetch(t.source).then((function(e){if(!e.ok)throw e.status+" - "+e.statusText;return t.progress=30,e.text()})).then((function(e){return t.progress=50,p.readGames(e)})).then((function(e){t.progress=70,t.games=p.sanitizeGames(e)})).then((function(){t.progress=0})).catch((function(e){t.progress=0,t.error=String(e)}))}))});return t},b=[{idx:0,key:"pgnimport00",caption:"Famous Chess Games",subline:"Collection included with Caissa, [21]",icon:o.a,source:r.a,constructor:v},{idx:1,key:"pgnimport01",caption:"Capablanca's Best Games",subline:"José Raúl Capablanca, 1888 – 1942, [11]",icon:o.a,source:a.a,constructor:v},{idx:2,key:"pgnurl00",caption:"Alekhine's Best Games",subline:"Alexander Alekhine, 1882 – 1946, [10]",icon:i.a,source:"/static/pgn/alekhine-best-games.pgn",info:"https://en.wikipedia.org/wiki/Alexander_Alekhine",constructor:g},{idx:3,key:"pgnurl01",caption:"FIDE Steinitz Memorial 2020",subtext:"The FIDE Online Steinitz Memorial took place 15th to 17th May 2020. Two 10 player events an Open and a Women's event - 18 Round Double Round Robin over 3 days. ",icon:i.a,source:"/static/pgn/steinitzmem20.pgn",info:"https://theweekinchess.com/chessnews/events/fide-online-steinitz-memorial-2020",constructor:g}];var w=[],y={list:function(){var e,t;return w.length||(e=b,t={user:s.a.Options.first["user-data"].name,month:("00"+((new Date).getUTCMonth()+1)).slice(-2),year:(new Date).getUTCFullYear()},w=e.map((function(e){return e.constructor(e,t)}))),w},find:function(e){return y.list().find(e)}};t.a=y},sK7Z:function(e,t,n){"use strict";var r,a,i,o=n("Mebt"),s=n("vdVe"),c=n("Jnlq"),u=Math.abs,l=innerWidth/3,d={selektor:"",time:NaN,down:{x:NaN,y:NaN},diff:{x:NaN,y:NaN}},h=o.a.transitionEnd,p={listen:function(){o.a.touch&&(document.addEventListener("touchstart",p.down,!1),document.addEventListener("touchmove",p.move,!1),document.addEventListener("touchend",p.end,!1),console.log("touchSlider.listening"))},remove:function(){document.removeEventListener("touchstart",p.down,!1),document.removeEventListener("touchmove",p.move,!1),document.removeEventListener("touchend",p.end,!1),console.log("touchSlider.removed")},pause:function(){d.selektor=""},init:function(e,t,n){setTimeout((function(){r=Object(c.a)("div.slide.left"),a=Object(c.a)("div.slide.right"),d.selektor="div.slide.center",e,t,i=n,l=innerWidth/4,console.log("touchSlider.init",e,t,n)}))},down:function(e){d.selektor&&e.target.closest(d.selektor)&&(d.time=Date.now(),d.down.x=e.touches[0].clientX,d.down.y=e.touches[0].clientY,d.diff.x=0,d.diff.y=0,console.log("touch.down",d.selektor))},onafterback:function(){r.removeEventListener(h,p.onafterback),s.a.goback()},onafterfore:function(){a.removeEventListener(h,p.onafterfore),s.a.gofore()},move:function(e){if(d.down.x||d.down.y){var t=e.touches[0].clientX,n=e.touches[0].clientY;d.diff.x=d.down.x-t,d.diff.y=d.down.y-n,u(d.diff.x)>3*u(d.diff.y)&&(r&&s.a.canBack&&d.diff.x<0&&(u(d.diff.x)>l?(r.addEventListener(h,p.onafterback),r.classList.add("page-slide","trans-center")):r.style.transform="translateX("+u(d.diff.x)+"px)"),a&&s.a.canFore&&d.diff.x>0&&(u(d.diff.x)>l?(a.addEventListener(h,p.onafterfore),a.classList.add("page-slide","trans-center")):a.style.transform="translateX("+(2*i-u(d.diff.x))+"px)"))}},end:function(){d.selektor&&(d.down={x:NaN,y:NaN},d.diff={x:NaN,y:NaN},r&&(r.addEventListener(h,(function e(){r.removeEventListener(h,e),r.classList.remove("page-slide")})),r.classList.add("trans-left","page-slide")),a&&(a.addEventListener(h,(function e(){a.removeEventListener(h,e),a.classList.remove("page-slide")})),a.classList.add("trans-right","page-slide")),console.log("touchSlider.ended",d.selektor))}};t.a=p},shM7:function(e,t,n){},t7ig:function(e,t,n){"use strict";(function(e){var r=n("nxTg"),a=n.n(r),i=n("5WRv"),o=n.n(i),s=(n("m6vW"),n("wyeM"),n("hpu3")),c=n("0iYD"),u=n("Wwkf"),l=n("Dpii"),d=function(e,t){return function(n){n.redraw=!1,s.c.route(e,t)}},h=c.a.create("Menu",{view:function(t){var n=t.attrs,r=n.className,i=n.style;return e("div.page.menu",{className:r,style:i},e(l.b,[e(l.j,"Menu")].concat(o()(Array.from(u.a.navigation).map((function(t){var n=a()(t,3),r=n[0],i=n[1],o=n[2];return e(l.c,{class:"",onclick:d(r,i)},[e(l.m,{class:"f3"},[i.src?e("img",{style:"padding-right: 14px; vertical-align: top",src:i.src,width:22,height:22}):e("i.menu.fa."+i.ico),o,e("div.f5.pb1.cddd","some clever hints")])])}))))))}});t.a=h}).call(this,n("mjLj"))},u6GA:function(e,t,n){"use strict";(function(e){var r=n("nxTg"),a=n.n(r),i=(n("shM7"),n("pP2Y")),o=n("Ehzf"),s=n("Dpii"),c=n("TqsC"),u=n("0iYD"),l=n("ZIMq"),d=u.a.create("Layout",{view:function(t){var n=t.attrs,r=n.route,u=n.params,d=a()(t.children,2),h=d[0],p=d[1];return e("div.layout",[e(o.a),e(i.a,{route:r,params:u}),e("main",{},[e("section.pages",{},e(l.a,{route:r,params:u},h)),innerWidth>=720?e("section.content",{},e(p,{route:r,params:u})):e("section.content",{},e(s.i))]),e(c.a,{msecs:Date.now()})])}});t.a=d}).call(this,n("mjLj"))},ujPc:function(e,t,n){},vVKl:function(e,t,n){"use strict";var r=n("Mebt"),a={engine:"ENGI",stockfish:"FISH",analyzer:"ANLY",logger:"LOGG",dispatcher:"DISP",games:"GAMS",evalgame:"NEWG",events:"EVTS",caissa:"CAIS"},i=[];function o(e,t){i.unshift((new Date).toLocaleTimeString()+" "+(a[e]||"----")+" - "+function(e){return e.replace(/infinite/g,'<strong class="dark-blue">infinite</strong>').replace(/readyok/g,'<strong class="dark-green">readyok</strong>').replace(/uciok/g,'<strong class="dark-green">uciok</strong>').replace(/bestmove/g,'<strong class="dark-blue">bestmove</strong>').replace(/ponder/g,'<strong class="dark-blue">ponder</strong>').replace(/-r>/g,'<strong class="dark-red">==></strong>').replace(/-g>/g,'<strong class="dark-green">==></strong>')}(t))}o("logger","init: "+(new Date).toLocaleDateString()),o("logger","init: "+(new Date).toLocaleTimeString()),o("logger","init: "+r.a.userAgent),t.a={log:o,shrink:function(e){return JSON.stringify(e).replace(/"/g,"").slice(0,140)},search:function(e){return e.length>2?i.filter((function(t){return t.includes(e)})):i}}},vdVe:function(e,t,n){"use strict";(function(e){var r=n("OvAC"),a=n.n(r),i=n("Jnlq"),o=n("Dpii"),s=n("hpu3");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={},d=[],h=NaN,p={back:!1,fore:!1,same:!1,replace:!1,redraw:!1,popstate:!1,hashchange:!1,noanimation:!1},f={stack:d,get pointer(){return h},log:function(){d.forEach((function(e,t){t===h?console.log("HIST."+t,[e.key,e.content.name,i.b.shrink(e.params)]):console.log("hist."+t,[e.key,e.content.name,i.b.shrink(e.params)])}))},isCurrent:function(e){return!(!d[h]||d[h].key!==e)},get current(){return d.length?d[h].key:""},get canBack(){return!isNaN(f.pointer)&&f.pointer>0},get canFore(){return!isNaN(f.pointer)&&f.pointer<f.stack.length-1},goback:function(){var e=d[h-1],t=e.route,n=e.params;s.c.route(t,n,{back:!0,noanimation:!0})},gofore:function(){var e=d[h+1],t=e.route,n=e.params;s.c.route(t,n,{fore:!0,noanimation:!0})},onback:function(e){e.redraw=!1;var t=d[h-1],n=t.route,r=t.params;return s.c.route(n,r,{back:!0}),i.b.eat(e)},onfore:function(e){e.redraw=!1;var t=d[h+1],n=t.route,r=t.params;return s.c.route(n,r,{fore:!0}),i.b.eat(e)},onhashchange:function(e){return p.hashchange=!0,i.b.eat(e)},onpopstate:function(e){return p.popstate=!0,i.b.eat(e)},recent:function(e){return d.map((function(e){return e.content})).slice(-e)},prepare:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{replace:!1},a=e.buildPathname(t,n);if(isNaN(h))l[a]=u({},r);else if(l[a]);else if(d[h]&&d[h].key===a)p.same=!0;else if(r.redraw)p.redraw=!0;else if(r.replace||p.replace)l[a]=u({},r),p.replace=!0,i.b.shrink(r);else if(r.back||p.back)p.back=!0,void 0!==r.noanimation&&(p.noanimation=!!r.noanimation);else if(r.fore||p.fore)p.fore=!0,void 0!==r.noanimation&&(p.noanimation=!!r.noanimation);else if(p.hashchange||p.popstate)if(p.hashchange&&d[h-1]&&d[h-1].key===a)p.back=!0;else if(p.hashchange&&d[h+1]&&d[h+1].key===a)p.fore=!0;else if(!p.hashchange&&p.popstate)p.same=!0;else for(l[a]=u({},r);d.length;)d.pop();else l[a]=u({},r)},finalize:function(t,n,r){var a=e.buildPathname(t,n);if(p.replace&&l[a])d[h].key=a,d[h].params=n,delete l[a];else if(p.redraw);else if(p.same||d[h]&&d[h].key===a)p.same=!0;else if(p.back)h-=1;else if(p.fore)h+=1;else if(l[a]){for(;h<d.length-1;)d.pop();h=d.push(i.b.create({key:a,route:t,params:n,content:r}))-1,delete l[a]}else;},get animation(){return 1===d.length?"=1=":p.replace?"=r=":p.redraw?"=w=":p.same?"=s=":p.back&&p.noanimation?"=b=":p.back&&!p.noanimation?"=b>":p.fore&&p.noanimation?"=f=":p.fore&&!p.noanimation?"<f=":"<c="},slides:function(){var e,t,n,r=i.b.create({content:o.i,route:"",params:i.b.create()});function a(e,t){return[0,1,2].map((function(t){return(d[h+e+t]||r).content.name})).concat([t,i.b.shrink(l)])}function s(e,t){return[0,1,2].map((function(t){return d[h+e+t]||r})).concat([t,i.b.shrink(l)])}if(1===d.length)e=a(-1,"=1="),t=s(-1,"=1=");else if(p.replace)e=a(n=-1,"=r="),t=s(n,"=r=");else if(p.redraw)e=a(n=-1,"=w="),t=s(n,"=w=");else if(p.same)e=a(n=-1,"=s="),t=s(n,"=s=");else if(p.back){var c=p.noanimation?"=b=":"=b>";e=a(0,c),t=s(0,c)}else if(p.fore){var u=p.noanimation?"=f=":"<f=";e=a(-2,u),t=s(-2,u)}else e=a(-2,"<c="),t=s(-2,"<c=");return i.b.clear(l),p.replace=!1,p.back=!1,p.fore=!1,p.same=!1,p.redraw=!1,p.popstate=!1,p.hashchange=!1,p.noanimation=!1,[t,e]}};t.a=f}).call(this,n("mjLj"))},wOn7:function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"e",(function(){return O})),n.d(t,"c",(function(){return P})),n.d(t,"d",(function(){return j})),n.d(t,"b",(function(){return D}));var r=n("SDJZ"),a=n.n(r),i=n("NToG"),o=n.n(i),s=["a1","b1","c1","d1","e1","f1","g1","h1","a2","b2","c2","d2","e2","f2","g2","h2","a3","b3","c3","d3","e3","f3","g3","h3","a4","b4","c4","d4","e4","f4","g4","h4","a5","b5","c5","d5","e5","f5","g5","h5","a6","b6","c6","d6","e6","f6","g6","h6","a7","b7","c7","d7","e7","f7","g7","h7","a8","b8","c8","d8","e8","f8","g8","h8"],c=function(){function e(){a()(this,e),this.squares=new Array(64).fill(null),this.orientation=null,this.markers=[],this.arrows=[]}return o()(e,[{key:"setPiece",value:function(e,t){this.squares[e]=t}},{key:"addMarker",value:function(e,t){this.markers.push({index:e,type:t})}},{key:"removeMarkers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.markers=null===e&&null===t?[]:this.markers.filter((function(n){if(null===n.type){if(e===n.index)return!1}else if(null===e){if(n.type===t)return!1}else if(n.type===t&&e===n.index)return!1;return!0}))}},{key:"addArrow",value:function(e,t,n,r){this.arrows.push({from:e,to:t,move:n,attributes:r})}},{key:"removeArrows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.arrows=null===e?[]:this.arrows.filter((function(t){return t.type!==e}))}},{key:"setPosition",value:function(e){if(e)for(var t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/),n=0;n<8;n++)for(var r=t[7-n].replace(/\d/g,(function(e){for(var t=parseInt(e),n="",r=0;r<t;r++)n+="-";return n})),a=0;a<8;a++){var i=r.substr(a,1),o=null;"-"!==i&&(o=i.toUpperCase()===i?"w".concat(i.toLowerCase()):"b".concat(i)),this.squares[8*n+a]=o}}},{key:"getPosition",value:function(){for(var e=new Array(8).fill(""),t=0;t<8;t++){for(var n=0,r=0;r<8;r++){var a=this.squares[8*t+r];if(null===a)n++;else{n>0&&(e[7-t]+=n,n=0);var i=a.substr(0,1),o=a.substr(1,1);e[7-t]+="w"===i?o.toUpperCase():o}}n>0&&(e[7-t]+=n,n=0)}return e.join("/")}},{key:"squareToIndex",value:function(e){var t=e.substr(0,1).charCodeAt(0)-97;return 8*(e.substr(1,1)-1)+t}}]),e}(),u={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},l=function(){function e(t,n,r,i,o,s){a()(this,e),this.view=t,this.state=n,this.props=r,this.moveStartCallback=i,this.moveDoneCallback=o,this.moveCanceledCallback=s,this.setMoveInputState(u.waitForInputStart)}return o()(e,[{key:"setMoveInputState",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.moveInputState;switch(this.moveInputState=e,e){case u.waitForInputStart:break;case u.pieceClickedThreshold:if(u.waitForInputStart!==r)throw new Error("moveInputState");if(this.startIndex=n.index,this.endIndex=null,this.movedPiece=n.piece,this.updateStartEndMarkers(),this.startPoint=n.point,this.pointerMoveListener||this.pointerUpListener)throw Error("_pointerMoveListener or _pointerUpListener");if("mousedown"===n.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",window.addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",window.addEventListener("mouseup",this.pointerUpListener);else{if("touchstart"!==n.type)throw Error("event type");this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",window.addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",window.addEventListener("touchend",this.pointerUpListener)}break;case u.clickTo:this.dragablePiece&&(k.removeElement(this.dragablePiece),this.dragablePiece=null),r===u.dragTo&&this.view.setPieceVisibility(n.index);break;case u.secondClickThreshold:if(u.clickTo!==r)throw new Error("moveInputState");this.startPoint=n.point;break;case u.dragTo:if(u.pieceClickedThreshold!==r)throw new Error("moveInputState");this.props.moveInputMode===O.dragPiece&&(this.view.setPieceVisibility(n.index,!1),this.createDragablePiece(n.piece));break;case u.clickDragTo:if(u.secondClickThreshold!==r)throw new Error("moveInputState");this.props.moveInputMode===O.dragPiece&&(this.view.setPieceVisibility(n.index,!1),this.createDragablePiece(n.piece));break;case u.moveDone:if(-1===[u.dragTo,u.clickTo,u.clickDragTo].indexOf(r))throw new Error("moveInputState");if(this.endIndex=n.index,this.endIndex&&this.moveDoneCallback(this.startIndex,this.endIndex)){var a=this.state.squares.slice(0);this.state.setPiece(this.startIndex,null),this.state.setPiece(this.endIndex,this.movedPiece),r===u.clickTo?this.view.animatePieces(a,this.state.squares.slice(0),(function(){t.setMoveInputState(u.reset)})):(this.view.drawPieces(this.state.squares),this.setMoveInputState(u.reset))}else this.view.drawPiecesDebounced(),this.setMoveInputState(u.reset);break;case u.reset:this.startIndex&&!this.endIndex&&this.movedPiece&&this.state.setPiece(this.startIndex,this.movedPiece),this.startIndex=null,this.endIndex=null,this.movedPiece=null,this.updateStartEndMarkers(),this.dragablePiece&&(k.removeElement(this.dragablePiece),this.dragablePiece=null),this.pointerMoveListener&&(window.removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(window.removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.setMoveInputState(u.waitForInputStart);break;default:throw Error("moveInputState ".concat(e))}}},{key:"createDragablePiece",value:function(e){if(this.dragablePiece)throw Error("dragablePiece exists");this.dragablePiece=k.createSvg(document.body),this.dragablePiece.setAttribute("width",this.view.squareWidth),this.dragablePiece.setAttribute("height",this.view.squareHeight),this.dragablePiece.setAttribute("style","pointer-events: none"),this.dragablePiece.name=e;var t=k.addElement(this.dragablePiece,"use",{href:"#".concat(e)}),n=this.view.squareHeight/this.props.sprite.grid,r=this.dragablePiece.createSVGTransform();r.setScale(n,n),t.transform.baseVal.appendItem(r)}},{key:"moveDragablePiece",value:function(e,t){this.dragablePiece.setAttribute("style","pointer-events: none; position: absolute; left: ".concat(e-this.view.squareHeight/2,"px; top: ").concat(t-this.view.squareHeight/2,"px"))}},{key:"onPointerDown",value:function(e){if("mousedown"===e.type&&0===e.button||"touchstart"===e.type){var t,n,r,a=e.target.getAttribute("data-index"),i=this.view.getPiece(a);if(void 0!==a)if(i&&(n=(t=i.getAttribute("data-piece"))?t.substr(0,1):null),this.moveInputState!==u.waitForInputStart||this.state.inputWhiteEnabled&&"w"===n||this.state.inputBlackEnabled&&"b"===n)"mousedown"===e.type?r={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===u.waitForInputStart&&t&&this.moveStartCallback(a)?this.setMoveInputState(u.pieceClickedThreshold,{index:a,piece:t,point:r,type:e.type}):this.moveInputState===u.clickTo&&(a===this.startIndex?this.setMoveInputState(u.secondClickThreshold,{index:a,piece:t,point:r,type:e.type}):this.setMoveInputState(u.moveDone,{index:a}))}}},{key:"onPointerMove",value:function(e){var t,n,r;if("mousemove"===e.type?(t=e.pageX,n=e.pageY,r=e.target):"touchmove"===e.type&&(t=e.touches[0].pageX,n=e.touches[0].pageY,r=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY)),this.moveInputState===u.pieceClickedThreshold||this.moveInputState===u.secondClickThreshold)(Math.abs(this.startPoint.x-t)>2||Math.abs(this.startPoint.y-n)>2)&&(this.moveInputState===u.secondClickThreshold?this.setMoveInputState(u.clickDragTo,{index:this.startIndex,piece:this.movedPiece}):this.setMoveInputState(u.dragTo,{index:this.startIndex,piece:this.movedPiece}),this.props.moveInputMode===O.dragPiece&&this.moveDragablePiece(t,n));else if(this.moveInputState===u.dragTo||this.moveInputState===u.clickDragTo||this.moveInputState===u.clickTo){if(r&&r.getAttribute&&r.parentElement===this.view.boardGroup){var a=r.getAttribute("data-index");a!==this.startIndex&&a!==this.endIndex?(this.endIndex=a,this.updateStartEndMarkers()):a===this.startIndex&&null!==this.endIndex&&(this.endIndex=null,this.updateStartEndMarkers())}else this.endIndex=null,this.updateStartEndMarkers();this.props.moveInputMode!==O.dragPiece||this.moveInputState!==u.dragTo&&this.moveInputState!==u.clickDragTo||this.moveDragablePiece(t,n)}}},{key:"onPointerUp",value:function(e){var t,n,r;if("mouseup"===e.type?r=e.target:"touchend"===e.type&&(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,r=document.elementFromPoint(t,n)),r&&r.getAttribute){var a=r.getAttribute("data-index");a?this.moveInputState===u.dragTo||this.moveInputState===u.clickDragTo?this.startIndex===a?this.moveInputState===u.clickDragTo?(this.state.setPiece(this.startIndex,this.movedPiece),this.view.setPieceVisibility(this.startIndex),this.setMoveInputState(u.reset)):this.setMoveInputState(u.clickTo,{index:a}):this.setMoveInputState(u.moveDone,{index:a}):this.moveInputState===u.pieceClickedThreshold?this.setMoveInputState(u.clickTo,{index:a}):this.moveInputState===u.secondClickThreshold&&(this.setMoveInputState(u.reset),this.moveCanceledCallback()):(this.view.drawPiecesDebounced(),this.setMoveInputState(u.reset),this.moveCanceledCallback())}else this.view.drawPiecesDebounced(),this.setMoveInputState(u.reset)}},{key:"updateStartEndMarkers",value:function(){this.state.removeMarkers(null,j.move),this.startIndex&&this.state.addMarker(this.startIndex,j.move),this.endIndex&&this.state.addMarker(this.endIndex,j.move),this.view.drawMarkersDebounced()}},{key:"destroy",value:function(){this.setMoveInputState(u.reset)}}]),e}(),d=0,h=1,p=2;function f(){}var m=function(){function e(t,n,r,i,o){if(a()(this,e),this.view=t,this.view.animationRunning)throw new f;n&&r&&(this.animatedElements=this.createAnimation(n,r),this.duration=i,this.callback=o,this.view.animationRunning=!0,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)))}return o()(e,[{key:"seekChanges",value:function(e,t){for(var n=this,r=[],a=[],i=[],o=0;o<64;o++){var s=e[o],c=t[o];c!==s&&(c&&r.push({piece:c,index:o}),s&&a.push({piece:s,index:o}))}return r.forEach((function(e){var t=8,r=null;a.forEach((function(a){if(e.piece===a.piece){var i=n.squareDistance(e.index,a.index);i<t&&(r=a,t=i)}})),r?(a.splice(a.indexOf(r),1),i.push({type:d,piece:e.piece,atIndex:r.index,toIndex:e.index})):i.push({type:h,piece:e.piece,atIndex:e.index})})),a.forEach((function(e){i.push({type:p,piece:e.piece,atIndex:e.index})})),i}},{key:"createAnimation",value:function(e,t){var n=this,r=this.seekChanges(e,t),a=[];return r.forEach((function(e){var t={type:e.type};switch(e.type){case d:t.element=n.view.getPiece(e.atIndex),t.atPoint=n.view.squareIndexToPoint(e.atIndex),t.toPoint=n.view.squareIndexToPoint(e.toIndex);break;case h:t.element=n.view.drawPiece(e.atIndex,e.piece),t.element.style.opacity=0;break;case p:t.element=n.view.getPiece(e.atIndex)}a.push(t)})),a}},{key:"animationStep",value:function(e){var t=this;this.startTime||(this.startTime=e);var n=e-this.startTime;n<=this.duration?this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)):(cancelAnimationFrame(this.frameHandle),this.view.animationRunning=!1,this.callback());var r=Math.min(1,n/this.duration),a=r<.5?2*r*r:(4-2*r)*r-1;this.animatedElements.forEach((function(e){if(e.element)switch(e.type){case d:e.element.transform.baseVal.removeItem(0);var n=t.view.svg.createSVGTransform();n.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*a,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*a),e.element.transform.baseVal.appendItem(n);break;case h:e.element.style.opacity=a;break;case p:e.element.style.opacity=1-a}else console.warn("animatedItem has no element",e)}))}},{key:"squareDistance",value:function(e,t){var n=e%8,r=Math.floor(e/8),a=t%8,i=Math.floor(t/8);return Math.max(Math.abs(i-r),Math.abs(a-n))}}]),e}(),v=1,g=2,b=3,w=function(){function e(t,n){var r=this;a()(this,e),this.animationRunning=!1,this.currentAnimation=null,this.chessboard=t,this.spriteLoadWaitingTries=0,this.loadSprite(t.props,(function(){r.spriteLoadWaitDelay=0,r.moveInput=new l(r,t.state,t.props,r.moveStartCallback.bind(r),r.moveDoneCallback.bind(r),r.moveCanceledCallback.bind(r)),r.animationQueue=[],t.props.responsive&&(r.resizeListener=r.handleResize.bind(r),window.addEventListener("resize",r.resizeListener)),t.props.moveInputMode!==O.viewOnly&&(r.pointerDownListener=r.pointerDownHandler.bind(r),r.chessboard.element.addEventListener("mousedown",r.pointerDownListener),r.chessboard.element.addEventListener("touchstart",r.pointerDownListener)),r.createSvgAndGroups(),r.updateMetrics(),n()}))}return o()(e,[{key:"pointerDownHandler",value:function(e){e.preventDefault(),this.moveInput.onPointerDown(e)}},{key:"destroy",value:function(){this.moveInput.destroy(),window.removeEventListener("resize",this.resizeListener),this.chessboard.element.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.element.removeEventListener("touchstart",this.pointerDownListener),window.clearTimeout(this.resizeDebounce),window.clearTimeout(this.redrawDebounce),window.clearTimeout(this.drawPiecesDebounce),window.clearTimeout(this.drawMarkersDebounce),window.clearTimeout(this.drawArrowssDebounce),k.removeElement(this.svg),this.animationQueue=[],this.currentAnimation&&cancelAnimationFrame(this.currentAnimation.frameHandle)}},{key:"loadSprite",value:function(t,n){var r=this;e.spriteLoadingStatus===v?(e.spriteLoadingStatus=g,k.loadSprite(t.sprite.url,["wk","wq","wr","wb","wn","wp","bk","bq","br","bb","bn","bp","marker1","marker2","marker3"].concat(t.sprite.markers),(function(){e.spriteLoadingStatus=b,n()}),t.sprite.grid)):e.spriteLoadingStatus===g?(setTimeout((function(){r.spriteLoadWaitingTries++,r.spriteLoadWaitingTries<50?r.loadSprite(t,n):console.error("timeout loading sprite",t.sprite.url)}),this.spriteLoadWaitDelay),this.spriteLoadWaitDelay+=10):e.spriteLoadingStatus===b?n():console.error("error ChessboardView.spriteLoadingStatus",e.spriteLoadingStatus)}},{key:"createSvgAndGroups",value:function(){this.svg&&k.removeElement(this.svg),this.svg=k.createSvg(this.chessboard.element);var e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.chessboard.props.style.showBorder?this.svg.setAttribute("class","cm-chessboard has-border "+e):this.svg.setAttribute("class","cm-chessboard "+e),this.updateMetrics(),this.boardGroup=k.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=k.addElement(this.svg,"g",{class:"coordinates"}),this.markersGroup=k.addElement(this.svg,"g",{class:"markers"}),this.arrowsGroup=k.addElement(this.svg,"g",{class:"caissa-arrows"}),this.piecesGroup=k.addElement(this.svg,"g",{class:"pieces"})}},{key:"updateMetrics",value:function(){this.width=this.chessboard.element.offsetWidth,this.height=this.chessboard.element.offsetHeight,this.chessboard.props.style.showBorder?this.borderSize=this.width/32:this.borderSize=this.width/320,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/this.chessboard.props.sprite.grid,this.scalingY=this.squareHeight/this.chessboard.props.sprite.grid,this.pieceXTranslate=this.squareWidth/2-this.chessboard.props.sprite.grid*this.scalingY/2}},{key:"handleResize",value:function(){var e=this;window.clearTimeout(this.resizeDebounce),this.resizeDebounce=setTimeout((function(){e.chessboard.element.offsetWidth===e.width&&e.chessboard.element.offsetHeight===e.height||(e.updateMetrics(),e.redraw()),e.svg.setAttribute("width","100%"),e.svg.setAttribute("height","100%")}))}},{key:"redraw",value:function(){var e=this;return new Promise((function(t){window.clearTimeout(e.redrawDebounce),e.redrawDebounce=setTimeout((function(){e.boardGroup&&(e.drawBoard(),e.drawCoordinates(),e.drawMarkers(),e.drawArrows(),e.setCursor())})),e.drawPiecesDebounced(e.chessboard.state.squares,(function(){t()}))}))}},{key:"drawBoard",value:function(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(k.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.showBorder){var e=this.borderSize-this.borderSize/9;k.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(var t=0;t<64;t++){var n=this.chessboard.state.orientation===x.white?t:63-t,r="square ".concat(0==(9*n&8)?"black":"white"),a=this.squareIndexToPoint(n),i=k.addElement(this.boardGroup,"rect",{x:a.x,y:a.y,width:this.squareWidth,height:this.squareHeight});i.setAttribute("class",r),i.setAttribute("data-index",""+n)}}},{key:"drawCoordinates",value:function(){if(this.chessboard.props.style.showCoordinates){for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);for(var e=!this.chessboard.props.style.showBorder,t=0;t<8;t++){var n=this.borderSize+(18+this.chessboard.props.sprite.grid*t)*this.scalingX,r=this.height-2.6*this.scalingY,a="coordinate file";e&&(n+=15.5*this.scalingX,this.chessboard.props.style.showBorder&&(r-=11*this.scalingY),a+=t%2?" dark":" light");var i=k.addElement(this.coordinatesGroup,"text",{class:a,x:n,y:r,style:"font-size: ".concat(8*this.scalingY,"px")});this.chessboard.state.orientation===x.white?i.textContent=String.fromCharCode(97+t):i.textContent=String.fromCharCode(104-t)}for(var o=0;o<8;o++){var s=this.borderSize/3.7,c=this.borderSize+24*this.scalingY+o*this.squareHeight,u="coordinate rank";e&&(u+=o%2?" light":" dark",this.chessboard.props.style.showBorder?(s+=10*this.scalingX,c-=15*this.scalingY):(s+=2*this.scalingX,c-=15*this.scalingY));var l=k.addElement(this.coordinatesGroup,"text",{class:u,x:s,y:c,style:"font-size: ".concat(8*this.scalingY,"px")});this.chessboard.state.orientation===x.white?l.textContent=8-o:l.textContent=1+o}}}},{key:"drawPiecesDebounced",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.squares,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;window.clearTimeout(this.drawPiecesDebounce),this.drawPiecesDebounce=setTimeout((function(){e.drawPieces(t),n&&n()}))}},{key:"drawPieces",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.squares;if(this.piecesGroup){for(;this.piecesGroup.firstChild;)this.piecesGroup.removeChild(this.piecesGroup.lastChild);for(var t=0;t<64;t++){var n=e[t];n&&this.drawPiece(t,n)}}}},{key:"drawPiece",value:function(e,t){var n=k.addElement(this.piecesGroup,"g");n.setAttribute("data-piece",t),n.setAttribute("data-index",e);var r=this.squareIndexToPoint(e),a=this.svg.createSVGTransform();a.setTranslate(r.x,r.y),n.transform.baseVal.appendItem(a);var i=k.addElement(n,"use",{href:"#".concat(t),class:"piece"}),o=this.svg.createSVGTransform();o.setTranslate(this.pieceXTranslate,0),i.transform.baseVal.appendItem(o);var s=this.svg.createSVGTransform();return s.setScale(this.scalingY,this.scalingY),i.transform.baseVal.appendItem(s),n}},{key:"setPieceVisibility",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getPiece(e);t?n.setAttribute("visibility","visible"):n.setAttribute("visibility","hidden")}},{key:"getPiece",value:function(e){return this.piecesGroup.querySelector("g[data-index='".concat(e,"']"))}},{key:"drawMarkersDebounced",value:function(){var e=this;window.clearTimeout(this.drawMarkersDebounce),this.drawMarkersDebounce=setTimeout((function(){e.drawMarkers()}),10)}},{key:"drawMarkers",value:function(){var e=this;if(this.markersGroup){for(;this.markersGroup.firstChild;)this.markersGroup.removeChild(this.markersGroup.firstChild);this.chessboard.state.markers.forEach((function(t){e.drawMarker(t)}))}}},{key:"drawMarker",value:function(e){var t=k.addElement(this.markersGroup,"g");t.setAttribute("data-index",e.index);var n=this.squareIndexToPoint(e.index),r=this.svg.createSVGTransform();r.setTranslate(n.x,n.y),t.transform.baseVal.appendItem(r);var a=k.addElement(t,"use",{href:"#".concat(e.type.slice),class:"marker "+e.type.class}),i=this.svg.createSVGTransform();return i.setScale(this.scalingX,this.scalingY),a.transform.baseVal.appendItem(i),t}},{key:"drawArrowsDebounced",value:function(){var e=this;window.clearTimeout(this.drawArrowsDebounce),this.drawArrowsDebounce=setTimeout((function(){e.drawArrows()}),10)}},{key:"drawArrows",value:function(){var e=this;if(this.arrowsGroup){for(;this.arrowsGroup.firstChild;)this.arrowsGroup.removeChild(this.arrowsGroup.firstChild);this.chessboard.state.arrows.forEach((function(t){e.drawArrow(t)}))}}},{key:"calcAngle",value:function(e,t,n,r){return e===n&&t<r?0:e>n&&t===r?90:e===n&&t>r?180:e<n&&t===r?270:e>n&&t<r?45:e>n&&t>r?135:e<n&&t>r?225:e<n&&t<r?315:22}},{key:"addPolyline",value:function(e,t){var n=k.addElement(e,"polyline");return n.setAttribute("points",t),n}},{key:"drawArrow",value:function(e){var t,n,r,a,i=k.addElement(this.arrowsGroup,"g",{class:e.attributes.class}),o=this.svg.createSVGTransform(),s=this.svg.createSVGTransform(),c=this.svg.createSVGTransform(),u=this.squareIndexToPoint(e.from),l=this.squareIndexToPoint(e.to),d=this.chessboard.props.sprite.grid/2,h=d/2,p=(u.x-l.x)/this.scalingX,f=(u.y-l.y)/this.scalingY,m=d-p,v=d-f,g=Math.abs(p)>Math.abs(f)?m:d,b=Math.abs(p)>Math.abs(f)?d:v;return e.attributes.onclick&&(i.addEventListener("click",e.attributes.onclick),i.addEventListener("touchstart",e.attributes.onclick)),o.setTranslate(u.x,u.y),i.transform.baseVal.appendItem(o),s.setScale(this.scalingX,this.scalingY),Math.abs(f)===Math.abs(p)||0===f||0===p?(n=this.addPolyline(i,"".concat(d,",").concat(d," ").concat(m,",").concat(v)),a=this.addPolyline(i,"".concat(m-10,",").concat(v-10," ").concat(m,",").concat(v," ").concat(m+10,",").concat(v-10)),t=this.calcAngle(u.x,u.y,l.x,l.y)):(n=this.addPolyline(i,"".concat(d,",").concat(d," ").concat(g,",").concat(b)),r=this.addPolyline(i,"".concat(g,",").concat(b," ").concat(m,",").concat(v)),a=this.addPolyline(i,"".concat(m-h,",").concat(v-h," ").concat(m,",").concat(v," ").concat(m+h,",").concat(v-h)),t=this.calcAngle(g,b,m,v),r.transform.baseVal.appendItem(s)),c.setRotate(t,m,v),n.transform.baseVal.appendItem(s),a.transform.baseVal.appendItem(s),a.transform.baseVal.appendItem(c),i}},{key:"animatePieces",value:function(e,t,n){this.animationQueue.push({fromSquares:e,toSquares:t,callback:n}),this.animationRunning||this.nextPieceAnimationInQueue()}},{key:"nextPieceAnimationInQueue",value:function(){var e=this,t=this.animationQueue.shift();void 0!==t&&(this.currentAnimation=new m(this,t.fromSquares,t.toSquares,this.chessboard.props.animationDuration/(this.animationQueue.length+1),(function(){e.moveInput.dragablePiece||e.drawPieces(t.toSquares),e.nextPieceAnimationInQueue(),t.callback&&t.callback()})))}},{key:"moveStartCallback",value:function(e){return!this.chessboard.moveInputCallback||this.chessboard.moveInputCallback({chessboard:this.chessboard,type:P.moveStart,square:s[e]})}},{key:"moveDoneCallback",value:function(e,t){return!this.chessboard.moveInputCallback||this.chessboard.moveInputCallback({chessboard:this.chessboard,type:P.moveDone,squareFrom:s[e],squareTo:s[t]})}},{key:"moveCanceledCallback",value:function(){this.chessboard.moveInputCallback&&this.chessboard.moveInputCallback({chessboard:this.chessboard,type:P.moveCanceled})}},{key:"setCursor",value:function(){var e=this;this.chessboard.initialization.then((function(){e.chessboard.state.inputWhiteEnabled||e.chessboard.state.inputBlackEnabled?e.boardGroup.setAttribute("class","board input-enabled"):e.boardGroup.setAttribute("class","board")}))}},{key:"squareIndexToPoint",value:function(e){var t,n;return this.chessboard.state.orientation===x.white?(t=this.borderSize+e%8*this.squareWidth,n=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,n=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:n}}}]),e}(),y="http://www.w3.org/2000/svg",k=function(){function e(){a()(this,e)}return o()(e,null,[{key:"createSvg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=document.createElementNS(y,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}},{key:"addElement",value:function(e,t,n){var r=document.createElementNS(y,t);for(var a in"use"===t&&(n["xlink:href"]=n.href),n)if(-1!==a.indexOf(":")){var i=a.split(":");r.setAttributeNS("http://www.w3.org/1999/"+i[0],i[1],n[a])}else r.setAttribute(a,n[a]);return e.appendChild(r),r}},{key:"removeElement",value:function(e){e.parentNode.removeChild(e)}},{key:"loadSprite",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=new XMLHttpRequest;i.open("GET",e),i.send(),i.onload=function(){var e=i.response,o=(new DOMParser).parseFromString(e,"image/svg+xml"),s=r.createSvg(document.body);s.setAttribute("style","display: none");var c=r.addElement(s,"defs");t.forEach((function(e){var t=o.getElementById(e);if(t){for(var n=t.transform.baseVal,r=0;r<n.numberOfItems;r++){var i=n.getItem(r);2===i.type&&i.setTranslate(i.matrix.e%a,i.matrix.f%a)}!function e(t){t.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&(t.removeAttribute("id"),t.hasChildNodes()&&e(t.childNodes))}))}(t.childNodes),c.appendChild(t)}else console.error("error, node id="+e+" not found in sprite")})),n(s)}}}]),e}();w.spriteLoadingStatus=v;var x={white:"w",black:"b"},O={viewOnly:0,dragPiece:1,dragMarker:2},P={moveStart:"moveStart",moveDone:"moveDone",moveCanceled:"moveCanceled",context:"context"},j={move:{class:"move",slice:"marker1"},emphasize:{class:"emphasize",slice:"marker2"},pointer:{class:"pointer",slice:"marker3"},rectwhite:{class:"rectwhite",slice:"marker4"},rectblack:{class:"rectblack",slice:"marker5"}},S="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",D=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a()(this,e),this.element=t,this.props={position:"empty",orientation:x.white,style:{cssClass:"default",showCoordinates:!0,showBorder:!1},responsive:!1,animationDuration:300,moveInputMode:O.viewOnly,sprite:{url:"./assets/images/chessboard-sprite.svg",grid:40}},Object.assign(this.props,r),this.props.sprite.grid||(this.props.sprite.grid=40),this.state=new c,this.state.orientation=this.props.orientation,this.initialization=new Promise((function(e){n.view=new w(n,(function(){"start"===n.props.position?n.state.setPosition(S):"empty"===n.props.position||null===n.props.position?n.state.setPosition("8/8/8/8/8/8/8/8"):n.state.setPosition(n.props.position),setTimeout((function(){n.view.redraw().then((function(){e()}))}))}))})).then((function(){i&&(console.warn("warning: the constructor callback is deprecated and will be removed in future versions"),i(n))}))}return o()(e,[{key:"setPiece",value:function(e,t){var n=this;return new Promise((function(r){n.initialization.then((function(){n.state.setPiece(n.state.squareToIndex(e),t),n.view.drawPiecesDebounced(n.state.squares,(function(){r()}))}))}))}},{key:"getPiece",value:function(e){return this.state.squares[this.state.squareToIndex(e)]}},{key:"setPosition",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r){t.initialization.then((function(){var a=t.state.getPosition();if(e.split(" ")[0]!==a){var i=t.state.squares.slice(0);"start"===e?t.state.setPosition(S):"empty"===e||null===e?t.state.setPosition("8/8/8/8/8/8/8/8"):t.state.setPosition(e),n?t.view.animatePieces(i,t.state.squares.slice(0),(function(){r()})):(t.view.drawPiecesDebounced(),r())}else r()}))}))}},{key:"getPosition",value:function(){return this.state.getPosition()}},{key:"addMarker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.emphasize;this.state.addMarker(this.state.squareToIndex(e),t),this.view.drawMarkersDebounced()}},{key:"addArrow",value:function(e,t,n){this.state.addArrow(this.state.squareToIndex(e),this.state.squareToIndex(t),e+t,n),this.view.drawArrowsDebounced()}},{key:"getMarkers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[];return this.state.markers.forEach((function(r){var a=s[r.index];(null===e&&(null===t||t===r.type)||null===t&&e===a||t===r.type&&e===a)&&n.push({square:s[r.index],type:r.type})})),n}},{key:"removeMarkers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null!==e?this.state.squareToIndex(e):null;this.state.removeMarkers(n,t),this.view.drawMarkersDebounced()}},{key:"removeArrows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.state.removeArrows(e),this.view.drawArrowsDebounced()}},{key:"setOrientation",value:function(e){this.state.orientation=e,this.view.redraw()}},{key:"getOrientation",value:function(){return this.state.orientation}},{key:"destroy",value:function(){var e=this;return new Promise((function(t){e.initialization.then((function(){e.view.destroy(),e.view=null,e.state=null,e.element.removeEventListener("contextmenu",e.contextMenuListener),t()}))}))}},{key:"enableMoveInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.props.moveInputMode===O.viewOnly)throw Error("props.moveInputMode is MOVE_INPUT_MODE.viewOnly");t===x.white?this.state.inputWhiteEnabled=!0:(t===x.black||(this.state.inputWhiteEnabled=!0),this.state.inputBlackEnabled=!0),this.moveInputCallback=e,this.view.setCursor()}},{key:"disableMoveInput",value:function(){this.state.inputWhiteEnabled=!1,this.state.inputBlackEnabled=!1,this.moveInputCallback=null,this.view.setCursor()}},{key:"enableContextInput",value:function(e){this.contextMenuListener?console.warn("contextMenuListener already existing"):(this.contextMenuListener=function(t){t.preventDefault();var n=t.target.getAttribute("data-index");e({chessboard:this,type:P.context,square:s[n]})},this.element.addEventListener("contextmenu",this.contextMenuListener))}},{key:"disableContextInput",value:function(){this.element.removeEventListener("contextmenu",this.contextMenuListener)}}]),e}()}},[["QfWi",2,3,0]]]);